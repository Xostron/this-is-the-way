!function(){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}!function(){var e=function(){var e=this;this.userCookie="",this.sessionId="",this.getUserCookie=function(){return"u2="+this.userCookie},this.getCleanUserCookie=function(){return this.userCookie},this.getSessionId=function(){return this.sessionId},this.setUserCookie=function(t){this.userCookie=t||this.userCookie,r()},this.setSessionId=function(t){this.sessionId=t||this.sessionId};var i="SZMKVVUD";function r(r){try{"object"===("undefined"==typeof localStorage?"undefined":t(localStorage))&&"function"==typeof localStorage.getItem&&"function"==typeof localStorage.setItem&&localStorage.setItem(i,JSON.stringify({usercookie:r||e.userCookie}))}catch(t){}}e.generate(),function(){try{if("object"===("undefined"==typeof localStorage?"undefined":t(localStorage))&&"function"==typeof localStorage.getItem){var n=localStorage.getItem(i);"string"==typeof n&&null!=n?"object"===t(n=JSON.parse(n))&&Boolean(n.usercookie)&&(e.userCookie=n.usercookie):r()}}catch(t){}}()};e.prototype.constructor=e,(r=e.prototype).generate=function(){var t,e="01234567890abcdef",i="",r="";for(t=0;t<8;t++)i+=e[Math.ceil(16*Math.random(0,1))];for(i+="-",t=0;t<4;t++)i+=e[Math.ceil(16*Math.random(0,1))];for(i+="-",t=0;t<4;t++)i+=e[Math.ceil(16*Math.random(0,1))];for(i+="-",t=0;t<4;t++)i+=e[Math.ceil(16*Math.random(0,1))];for(i+="-",t=0;t<12;t++)i+=e[Math.ceil(16*Math.random(0,1))];for(t=0;t<19;t++)r+=Math.ceil(10*Math.random(0,1))-1;this.sessionId=r,this.userCookie=i};var i=function(t){this.version,this.set(t)};i.prototype.constructor=i,(r=i.prototype).set=function(t){return this.version=void 0!==t&&"SAS"==t?"SAS":"MDX",this},r.get=function(){return"SAS"==this.version?"SAS":"MDX"},r.isSAS=function(){return"SAS"==this.get()},r.isMDX=function(){return!this.isSAS()},r.inited=function(){return"object"===t(this.shared)},r.fire=function(){if(this.inited()){var t=["cn=tf","c=19","mc=imp","pli="+this.shared.campaignData.getPlacementId(),"PluID=0","ord="+l.getInteger(19),"&rtu=-1"],e="https://"+this.shared.report_host+"/serving/adServer.bs?"+t.join("&"),i=new XMLHttpRequest;i.open("GET",e,!0),i.send()}};var r,n=function(){this.aid=-1,this.advid=-1,this.sdg=-1,this.pid=-1;for(var t=-1,e=0;e<8;e++)this.dg+=Math.ceil(10*Math.random(0,1))-1;this.getAdId=function(){return this.aid},this.getAdvertiserId=function(){return this.advid},this.getSdgId=function(){return this.sdg},this.getPlacementId=function(){return this.pid},this.getCampaignId=function(){return t},this.setAdId=function(t){return this.aid=t,this},this.setAdvertiserId=function(t){return this.advid=t,this},this.setSdgId=function(t){return this.sdg=t,this},this.setPlacementId=function(t){return this.pid=t,this},this.setCampaignId=function(e){return t=void 0!==e?e:t,this}},s=function(){this.aid=-1,this.width=300,this.height=300;var t="";this.volume=0,this.getAdId=function(){return this.aid},this.getWidth=function(){return this.width},this.getHeight=function(){return this.height},this.getSlot=function(){return t},this.getVolume=function(){return this.volume},this.isInited=function(){return""!==t},this.setAdId=function(t){return this.aid=void 0!==t?t:this.aid,this},this.setWidth=function(t){return this.width=void 0!==t?t:this.width,this},this.setHeight=function(t){return this.height=void 0!==t?t:this.height,this},this.setVolume=function(t){return this.volume=void 0!==t?t:this.volume,this},this.setSlot=function(e){return t=void 0!==e&&e||t,this.isInited()&&(this.setWidth(t.width),this.setHeight(t.height)),this}},o=function(t){this.shared=t||{};var e=this,i=function(t){var i=!1;try{i=new URL("https://"+e.shared.report_host+"/Serving"+t+"&s=ya")}catch(t){e.shared.catch({message:t.message})}if(!1!==i)try{navigator.sendBeacon(i)}catch(t){(new Image).src=i}};this.sendMetric=function(t,e){if(void 0!==t){var r="";r="/adServer.bs",r+="?cn=int",r+="&iv=2",r+="&"+(!0!==e?"int":"interactionsStr")+"=",r+=!0!==e?"":"$$",r+=this.shared.campaignData.getPlacementId(),r+="~~0~~",r+=this.shared.campaignData.getCampaignId(),r+="~~",r+=this.shared.userData.getSessionId(),r+=t,r+=!0!==e?"":"$$",r+="&usercookie="+this.shared.userData.getUserCookie(),r+="&OptOut=1",r+="&rnd="+Math.random(),i(r+="&res=0")}},this.sendImpression=function(){var t="?cn=display";t+="&c=40",t+="&sessionid="+this.shared.userData.getSessionId(),t+="&ai="+this.shared.campaignData.getAdId(),t+="&usercookie="+this.shared.userData.getUserCookie(),t+="&oo=1",t+="&clsrc=2",t+="&clbv=_2_218_3_0",t+="&dg="+this.shared.campaignData.getSdgId(),t+="&sdg="+this.shared.campaignData.getSdgId(),t+="&ctick=4281",t+="&ord="+Math.random(),i(t)},this.sendClick=function(t){var e="/adServer.bs";e+="?cn=brd",e+="&PluID=0",e+="&Pos="+Math.random(),e+="&EyeblasterID="+this.shared.campaignData.getPlacementId(),e+="&clk=1",e+="&sct=1",e+="&dg="+this.shared.campaignData.getSdgId(),e+="&dgo="+this.shared.campaignData.getSdgId(),e+="&di=0",e+="&pc=",e+="&sessionid="+this.shared.userData.getSessionId(),e+="&usercookie="+this.shared.userData.getUserCookie(),e+="&OptOut=1",e+="&gdprpurposes=1023",e+="&ctick=0","string"==typeof t&&""!=t&&(e+="&ebReferrer="+encodeURIComponent(t)),i(e)},this.sendDomain=function(t){if("string"==typeof t&&""!=t){var e="";e+="%5EverURL",e+="~url%3D",e+=encodeURIComponent(t),e+="%26method%3D3~0~01020~786",this.sendMetric(e,!0)}}},a=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,r=t.prototype};function c(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body,i=Array.from(e.querySelectorAll("*")).map((function(t){return t.shadowRoot})).filter(Boolean),r=i.map((function(e){return c(t,e)})),n=Array.from(e.querySelectorAll(t));return n.concat(r).flat()}var h="normal",u=function(e,i){this.type=e,this.timestamp=Number(new Date),(this.data={eventData:function(e){var i={};for(var r in e){var n=e[r];i[r]="object"===t(n)?this.copy(n):e[r]}return i}(i)}).adData={}},l={sessionValues:[null,void 0],getTime:function(){return(new Date).getTime()},getUUID:function(t){t=t||!1;var e=l.populate,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),r=[e(8,i),"szmk",e(4,i),e(4,i),e(12,i)];return r=r.join("-"),t?r.toUpperCase():r.toLowerCase()},getInteger:function(t){t=t||8;for(var e=[1,2,3,4,5,6,7,8,9,0],i=[];!i[0];)l.shuffle(e),i[0]=e[0];return l.populate(t,e,i)},getString:function(t,e){return(e?e+"-":"")+l.populate(t||16,"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""))},getRandomArray:function(t,e){t=t||1,e=e||16;for(var i=[],r="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");i.length<t;)i.push(l.populate(e,r));return i},populate:function(t,e,i){for(i=i||[];i.length<t;)l.shuffle(e),i.push(e[0]);for(var r=i.join("");l.sessionValues.indexOf(r)>-1;)r=l.populate(t,e);return l.sessionValues.push(r),r},shuffle:function(t){for(var e=t.length-1;e>=0;e--){var i=Math.floor(Math.random()*(e+1)),r=t[i];t[i]=t[e],t[e]=r}}},d="LoadComplete",g="Error",p="VendorReady",V="VendorStopped",f="AdBlocked",E="Destructed",D=function(t,e){this.type=t,this.data=e||{},this.target=null,this.currentTarget=null},m=function(t,e,i,r){this.type=t,e.handleEvent?(this.callback=e.handleEvent,this.context=e):(this.callback=e,this.context=i),this.priority=r||0};m.prototype.constructor=m,(r=m.prototype).emit=function(t){var e=this.callback,i=this.context;"function"==typeof e&&e.apply(i||this,[t])};var y=function(){this.subscribers={}};y.prototype.constructor=y,(r=y.prototype).addSubscriber=function(t,e,i,r){t&&(r=r||0,this.subscribers[t]||(this.subscribers[t]=[]),this.checkDuplicates(t,e,i)&&this.subscribers[t].unshift(new m(t,e,i,r)),this.subscribers[t].sort((function(t,e){return t.priority-e.priority})))},r.removeSubscriber=function(t,e,i){var r=this.subscribers[t];if(r)for(var n=0;n<r.length;n++){var s=r[n];if(s.callback==e&&s.context==i){r.splice(n,1);break}}},r.checkDuplicates=function(t,e,i){for(var r,n=this.subscribers[t].slice(),s=!0;n.length;)if((r=n.pop()).type==t&&r.callback==e&&r.context==i){s=!1;break}return s},r.emit=function(t){var e=this.subscribers[t.type];if(e)for(var i=e.slice();i.length;)i.pop().emit(t)},r.removeType=function(t){delete this.subscribers[t]};var B=function(){this.subscribers=new y};B.prototype.constructor=B,(r=B.prototype).attachListener=function(t,e,i,r){this.subscribers||(this.subscribers=new y),this.subscribers.addSubscriber(t,e,i,r)},r.deleteListener=function(t,e,i){this.subscribers.removeSubscriber(t,e,i)},r.deleteAllEvents=function(){this.subscribers=new y},r.deleteType=function(t){this.subscribers&&this.subscribers.removeType(t)},r.emit=function(t){this.dispatch(t)},r.dispatch=function(t){this.subscribers&&(t.target=t.target?t.target:this,t.currentTarget=this,this.subscribers.emit(t))};var G=function(t){for(var e in B.call(this),t=(t=t.AdParameters||t).replace(/\[\%\w+\%\]/g,"false"),this.value=t=JSON.parse(t),t)"string"==typeof t[e]&&(t[e]=decodeURI(t[e]))};a(G,B);var T=function(t){this.width=0,this.height=0,this.viewMode=h,this.adParameters={},this.desiredBitrate=1/0,this.environmentVars={},this.shared=t};T.prototype.constructor=T,r=T.prototype;var _=function(t){B.call(this),this.initData=new T(t)},v=function(t){var e=t.data.initData.adParameters.value,i=t.vpaid;t.data.initData.environmentVars,this.adData=new A(e,i),this.vendorData=new I(e),this.slots={slot:t.creativeData.getSlot(),videoSlot:t.creativeData.getSlot()},this.timestamp=Number(new Date),this.secure=!1,this.verificationClientURL=e.vvu},A=function(t){var e=t;this.adID=e.aid||-1,this.placementID=e.pid||-1,this.placementName=e.pn||null,this.adDuration="00:00:00",this.adLinear={},this.campaignName=e.cn||null,this.campaignID=e.cid||-1,this.siteName=e.sn||null,this.siteID=e.sid||-1,this.timeout=1500,this.seg=e.seg||-1},I=function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},b=function(t){B.call(this,t),this.shared=t};a(b,B),r.load=function(){try{EBG.VV,EBG=null}catch(t){}var t=this.shared.creativeData.getSlot().ownerDocument;new C(t.defaultView||t.parentWindow,t).getLib(),this.onScriptLoad()},r.onScriptLoad=function(){this.emit(new D(d))},r.onScriptError=function(){this.emit(new D(g))},r.getAdapter=function(){return window.vendorAdapter.getAPI()},r.dispose=function(){};var S=function(t){B.call(this),this.shared=t,this._api=null,this.version="1.0.0",this.eventsQueue=[new u("AdLoaded"),new u("AdStarted"),new u("AdImpression")],this._frame=null,this.loaded=!1};a(S,B),r.load=function(){var t=new v(this.shared),e=this,i=setTimeout((function(){e.removeEvents(),c(),e.dispose()}),1500);e.loadCallback=s,e.errorCallback=a;var r=!1,n=this._frame=new b(this.shared);function s(){n.deleteListener(d,e.loadCallback,!1),function(){try{var i=e._api=n.getAdapter();for(i.subscribe(p,o),i.initService(t);e.eventsQueue.length>0;)i.update(e.eventsQueue.shift())}catch(t){e.emit(new D(g))}}()}function o(){if(!r){r=!0;var t=e._api.getInstructions();t&&t.adBlocking&&"BlockAd"===t.adBlocking?e.emit(new D(f)):(clearTimeout(i),c())}}function a(){e.removeEvents(),c(),e.dispose()}function c(){clearTimeout(i),e.loaded=!0,e.emit(new D(d))}n.attachListener(d,s,!1),n.attachListener(g,a,!1),n.load(t.verificationClientURL)},r.removeEvents=function(){this.deleteListener(p,this.vendorReadyCallback,this),this.deleteListener(f,this.adBlockCallback,this),this._frame&&(this._frame.deleteListener(d,this.loadCallback,this),this._frame.deleteListener(g,this.errorCallback,this))},r.update=function(){this._api?this._api.update(event):this.eventsQueue.push(event)},r.dispose=function(){var t=this;if(this._api){this._api.subscribe(V,i);var e=setTimeout(i,500,new D(V))}else t.emit(new D(E));function i(i){i.type===V&&(clearTimeout(e),t.removeEvents(),t._frame&&(t._frame.dispose(),t._frame=null,t._api=null),t.emit(new D(E)))}};var R=function(){this.data=new _(this),this.verification=new S(this),this.userData=new e,this.campaignData=new n,this.creativeData=new s,this.protocol=new i,this.report_host="bs.serving-sys.ru",this.catch=function(t,e){e=e||"default",console.log("exception : ["+e+"] "+(t.message||"error"))},this.slot};function C(){this.getLib=function(){var e;e={declareNamespace:function(t){for(var e=window.EBG,i=(t=t.split("."),0);i<t.length;i++){var r=t[i],n=e[r];n||(n=e[r]={}),e=n}},declareClass:function(t,e){return t.prototype.constructor=t,e&&(t.__superClass=e,t.__basePrototypePending=!0,EBG._resolveInheritance(t)),t},_resolveInheritance:function(t){if(t.__basePrototypePending){var e=t.__superClass;EBG._resolveInheritance(e),e=e.prototype;var i,r=t.prototype;for(i in e)r[i]=r[i]||e[i];delete t.__basePrototypePending}},callSuperConstructor:function(t,e,i){return(t=t.__superClass)&&(i?t.apply(e,i):t.apply(e)),e},callSuperFunction:function(t,e,i,r){if(t=t.__superClass)var n=t.prototype[i];try{if(n)return r?n.apply(e,r):n.apply(e)}catch(t){}},mergeObj:function(t,e,i){for(var r in i=Boolean(i),t)!t.hasOwnProperty(r)||e.hasOwnProperty(r)&&!i||(e[r]=t[r])},isDefined:function(t){return void 0!==t},typeOf:function(e){var i=t(e);if("object"==i){if(!e)return"function"==i&&void 0===e.call?"object":"null";if(e instanceof Array||!(e instanceof Object)&&"[object Array]"==Object.prototype.toString.call(e)||"number"==typeof e.length&&void 0!==e.splice&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if(!(e instanceof Object||"[object Function]"!=Object.prototype.toString.call(e)&&(void 0===e.call||void 0===e.propertyIsEnumerable||e.propertyIsEnumerable("call"))))return"function"}return i},isNumber:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},isFunc:function(t){return"function"==EBG.typeOf(t)},walkUpIframes:function(t,e,i,r){var n=(i=i||window).location.origin||i.location.protocol+"//"+i.location.host,s=i,o=!1,a="";r=Boolean(r);try{if(i.location.ancestorOrigins)for(t&&t.call(s),a=0;a<i.location.ancestorOrigins.length;a++){if(0==a&&"null"==n&&(n=i.location.ancestorOrigins[0]),s=s.parent,o=!1,i.location.ancestorOrigins[a]==n)try{o=!0}catch(t){o=!1}if(o)t&&t.call(s);else{try{e&&e.call(s)}catch(t){}if(!r)break}}else for(t&&t.call(s);s!==s.parent;){s=s.parent,a=null;try{a=s.location.origin||s.location.protocol+"//"+s.location.host,("null"==n||"about://"==n)&&(n=a)}catch(t){}if(a===n)t&&t.call(s);else{try{e&&e.call(s)}catch(t){}if(!r)break}}}catch(t){}},indexOfArray:function(t,e){for(var i=0;i<t.length;i++)if(t[i]==e)return i;return-1},getTime:function(){var t=Date.now?Date.now():(new Date).getTime();return function(e){return(Date.now?Date.now():(new Date).getTime())-t*Boolean(e)}}(),generateID:function(){var t=0;return function(){return++t}}(),isHtmlElement:function(e){var i=e&&e.ownerDocument&&(e.ownerDocument.defaultView||e.ownerDocument.parentwindow);return Boolean(!i||"object"!==t(i.HTMLElement)&&"function"!=typeof i.HTMLElement?e&&"object"===t(e)&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName:e instanceof i.HTMLElement)},isValidVideoElement:function(t){return e.isHtmlElement(t)&&"VIDEO"==t.tagName},isIframe:function(t){return e.isHtmlElement(t)&&"IFRAME"==t.tagName},idleCallback:function(t,e){return function(){window.requestIdleCallback?requestIdleCallback((function(){t.apply(e)}),{timeout:10}):setTimeout((function(){t.apply(e)}),1)}},log:{debug:function(t){console.log(t)}}},window.EBG=window.EBG||{},e.mergeObj(e,EBG,!1);var i={n:4,j:2,h:3,l:0};EBG.declareNamespace("VV"),EBG.VV=function(t){var e;(i=window.EBG.vv)?e=i.shared:((e=this.shared).reporter=new EBG.VV.Reporting.ReportManager,e.metricsManager=new EBG.VV.Metrics.MetricsManager(e),e.detectionManager=new EBG.VV.Detection.DetectionManager(e));var i,r=EBG.generateID();return(i=i||this).targetGroups[r]=new EBG.VV.Target.TargetGroup(e,r,t),i},EBG.VV.prototype={shared:{},targetGroups:[],destroy:function(){for(var t in this.shared.reporter.destroy(),this.shared.metricsManager.destroy(),this.shared.detectionManager.destroy(),this.targetGroups)this.targetGroups.hasOwnProperty(t)&&this.targetGroups[t].destroy()}},EBG.VV.TargetType={TARGET_GROUP:"group",TARGET_ENTITY:"entity",PAGE:"page"},EBG.VV.HostURLExtractMethod={PUBLISHER:1,TOP:2,REFERRER:3},EBG.VV.DetectionTypes={VIEWABLE_RATIO:"viewableRatio",SCREENSHARE_RATIO:"screenShareRatio",PAGE_VISIBILITY:"pageVisibility",PAGE_UNLOAD:"pageUnload",AD_UNLOAD:"adUnload",QUERY_STRING:"queryString",TARGET_API:"targetApi",VIEWABILITY_RECORDABLE:"recordable",OVERLAP:"overlap",VER_URL:"verURL",CLICK:"AdClickThru",CONCURRENT_TARGET:"concurrentTarget",USER_AGENT:"userAgent",ANCESTOR_ORIGINS:"ancestorOrigins",AD_FULLSCREEN_CHANGE:"adFullscreenChange",SCREEN_RECT:"screenRect",WINDOW_RECT:"windowRect",VIEWPORT_RECT:"viewportRect",AD_LOADED:"AdLoaded",AD_START:"AdStarted",AD_STOPPED:"AdStopped",AD_SKIPPED:"AdSkipped",AD_SKIPPABLE_STATE_CHANGE:"AdSkippableStateChange",AD_SIZE_CHANGE:"AdSizeChange",AD_LINEAR_CHANGE:"AdLinearChange",AD_DURATION_CHANGE:"AdDurationChange",AD_EXPANDED_CHANGE:"AdExpandedChange",AD_REMAINING_TIME_CHANGE:"AdRemainingTimeChange",AD_VOLUME_CHANGE:"AdVolumeChange",AD_IMPRESSION:"AdImpression",AD_VIDEO_START:"AdVideoStart",AD_VIDEO_FIRST_QUARTILE:"AdVideoFirstQuartile",AD_VIDEO_MIDPOINT:"AdVideoMidpoint",AD_VIDEO_THIRD_QUARTILE:"AdVideoThirdQuartile",AD_VIDEO_COMPLETE:"AdVideoComplete",AD_CLICKTHRU:"AdClickThru",AD_INTERACTION:"AdInteraction",AD_USER_ACCEPT_INVITATION:"AdUserAcceptInvitiation",AD_USER_MINIMIZE:"AdUserMinimize",AD_USER_CLOSE:"AdUserClose",AD_PAUSED:"AdPaused",AD_PLAYING:"AdPlaying",AD_ERROR:"AdError"},EBG.VV.Type={BOOLEAN:"boolean"},EBG.declareNamespace("VV.Tokens"),EBG.VV.Tokens.SZMKVVQueryString={AD_ID:"ai",SESSION_ID:"si",CONFIG_URL:"cru",PLACEMENT_ID:"pli"},EBG.declareNamespace("VV.Reporting"),EBG.VV.Reporting.ReportManager=function(){this.reporters=[],this.sender=new EBG.VV.Reporting.Sender},EBG.VV.Reporting.ReportManager.prototype={report:function(t,e){for(var i=this._getReportersForTargetGroup(t.target.group),r={metric:t,detectionData:e},n=0;n<i.length;n++)i[n].report(r)},send:function(t,e,i){this.sender.send(t.url,t.data,e,i)},destroy:function(){},_getReportersForTargetGroup:function(t){var e=this.reporters[t.id];return e||(e=this.reporters[t.id]=this._createReportersForTargetGroup(t)),e},_createReportersForTargetGroup:function(t){var e=[new(t.config.featureFlags.RFF_UnloadQueue?EBG.VV.Reporting.UnloadQueueReporter:EBG.VV.Reporting.Reporter)(this,t)];return EBG.isDefined(t.config)&&t.config.logCollectorURL&&e.push(new EBG.VV.Reporting.SamuraiReporter(this,t)),e}},EBG.VV.Reporting.Reporter=function(t,e){this.formatter=new EBG.VV.Reporting.Formatter(e),this.blacklist=["metrics"],this.manager=t,this._init()},EBG.VV.Reporting.Reporter.prototype={_init:function(){},report:function(t){(t=this._handle(t))&&(this.send(this.formatter.format(t),null,!(t.useSyncXHR||t.detectionData.type==EBG.VV.DetectionTypes.PAGE_UNLOAD||t.detectionData.type==EBG.VV.DetectionTypes.AD_UNLOAD)),window.parent.postMessage(t.metric.metricName,"*"))},send:function(t,e,i){this.manager.send(t,e,i)},_handle:function(t){return!(EBG.indexOfArray(this.blacklist,t.metric.metricName)>-1)&&t}},EBG.VV.Reporting.Formatter=function(t){var e=this._getProtocol(t);t=this._getHostname(t),this._interactionPipe=e+t+"/Serving/adServer.bs?cn=int&iv=2&int=",this._interactionsStrPipe=e+t+"/Serving/adServer.bs?cn=int&iv=2&interactionsStr=",this._clickPipe=e+t+"/Serving/adServer.bs?cn=trd",this._impPipe=e+t+"/Serving?cn=display&c=40"},EBG.VV.Reporting.Formatter.prototype={format:function(t){return{url:t.queue?this.getQueueUrl(t):t.detectionData.type==EBG.VV.DetectionTypes.AD_CLICKTHRU?this.getClickUrl(t):t.metric.metricName==EBG.VV.DetectionTypes.AD_IMPRESSION?this.getImpressionURL(t):"object"==EBG.typeOf(t.metric.value)?this.getInteractionStrUrl(t):this.getSingleMetricUrl(t),data:null}},getPipePrefix:function(t){return t.metric.target.group.config.adId+"~~0~~"+t.metric.target.group.config.placementId+"~~"+t.metric.target.group.config.sessionId},getPipeSuffix:function(t){return"&s="+t.metric.target.group.config.source+"&usercookie="+t.metric.target.group.config.usercookie+"&diappid="+t.metric.target.group.config.diappid+"&OptOut="+~~t.metric.target.group.config.optOut+"&rnd="+Math.random()},getSingleMetricString:function(t){var e="",i=Number(t.metric.isClick),r=t.metric.isUnique();return e=e+"^"+t.metric.name+"~"+t.metric.value+"~0~"+i+r+Number(t.detectionData.userInitiated)+Number(t.metric.category)+"0",t.metric.target.group.config.featureFlags.RFF_Tick&&(e=e+"~"+(t.detectionData.timestamp-t.metric.target.group.config.timestamp)),e},getClickUrl:function(t){var e=t.metric.target.group.config.usercookie||"",i=~~t.metric.target.group.config.optOut,r=t.metric.target.group.config.diappid||"",n=t.metric.target.group.config.source||"";return this._clickPipe+"&s="+n+"&sessionid="+(t.metric.target.group.config.sessionId||"")+"&pli="+(t.metric.target.group.config.placementId||"")+"&ord="+EBG.getTime()+"&usercookie="+e+"&diappid="+r+"&oo="+i},getImpressionURL:function(t){var e=t.metric.target.group.config.sessionId||"",i=t.metric.target.group.config.adId||"",r=t.metric.target.group.config.usercookie||"",n=~~t.metric.target.group.config.optOut,s=t.metric.target.group.config.diappid||"",o=t.metric.target.group.config.source||"";return t=EBG.getTime()-t.metric.target.group.config.handleStartTime,this._impPipe+"&s="+o+"&sessionid="+e+"&ai="+i+"&usercookie="+r+"&oo="+n+"&diappid="+s+"&ord="+EBG.getTime()+"&ctick="+t},getInteractionStrUrl:function(t){var e,i=this._interactionsStrPipe+"$$"+this.getPipePrefix(t),r=[];for(e in t.metric.value)r.push(e+"="+t.metric.value[e]);return t.metric.value=encodeURIComponent(r.join("&")),(i+=this.getSingleMetricString(t))+"$$"+this.getPipeSuffix(t)},getSingleMetricUrl:function(t){return this._interactionPipe+this.getPipePrefix(t)+this.getSingleMetricString(t)+this.getPipeSuffix(t)},getQueueUrl:function(t){for(var e=this._interactionPipe+this.getPipePrefix(t.queue[0]),i=0;i<t.queue.length;i++)e+=this.getSingleMetricString(t.queue[i]);return e+this.getPipeSuffix(t.queue[0])},_getMaxQueryLength:function(){return 2e3},_getProtocol:function(t){var e="https://";return"http://"!=(t=t.config.protocol)&&"https://"!=t||(e=t),e},_getHostname:function(t){var e=t.config.report_host;return t.config.reportHost?e=t.config.reportHost:t.config.hostname&&(e=(e=t.config.hostname.replace("secure-","")).replace("ds","bs")),e}},EBG.VV.Reporting.Sender=function(){},EBG.VV.Reporting.Sender.prototype={send:function(t,e,i,r){"function"!=typeof navigator.sendBeacon||i?(r=!EBG.isDefined(r)||r,EBG.isDefined(e)&&""!=e?this._post(t,e,i,r):this._ajax.get(t,i,r)):navigator.sendBeacon(t,e)},_post:function(t,e,i,r){this._ajax.post(t,e,i,r)},_ajax:{x:function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(var t,e=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],i=0;i<e.length;i++)try{t=new ActiveXObject(e[i]);break}catch(t){}return t},get:function(t,e,i){try{var r=this.x();r.open("GET",t,i),r.onreadystatechange=function(){4==r.readyState&&e&&e(r.responseText)},r.send()}catch(t){}},post:function(t,e,i,r){try{var n=this.x();n.open("POST",t,r),n.onreadystatechange=function(){4==n.readyState&&i&&i(n.responseText)},n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(e)}catch(t){}}}},EBG.VV.Reporting.UnloadQueueReporter=function(t,e){EBG.callSuperConstructor(EBG.VV.Reporting.UnloadQueueReporter,this,[t,e])},EBG.VV.Reporting.UnloadQueueReporter.prototype={_queueAbleMetrics:["eos"],_unloadQueueObj:{queue:[],useSyncXHR:!0,metric:{name:"unloadQueue"}},_handle:function(t){if(EBG.indexOfArray(this.blacklist,t.metric.metricName)>-1)return!1;var e=this.manageUnloadQueue(t);return e&&this.shouldSendQueue()?this._unloadQueueObj:!e&&t},manageUnloadQueue:function(t){switch(t.metric.metricName){case"VsR":this._queueAbleMetrics.push("VsAvSu","VsAvSc");break;case"VsAd":this._queueAbleMetrics.push("VsAdDu");break;case"VsAg":this._queueAbleMetrics.push("VsAgDu");break;case"ebVideoStarted":this._queueAbleMetrics.push("ebVideoPlayDuration");break;case"AdStart":this._queueAbleMetrics.push("ebAdDuration");break;default:if(this._queueAbleMetrics.indexOf(t.metric.name)>-1)return"eos"===t.metric.name?this._unloadQueueObj.queue.push(t):this._unloadQueueObj.queue.unshift(t),this._queueAbleMetrics.splice(this._queueAbleMetrics.indexOf(t.metric.name),1),!0}return!1},shouldSendQueue:function(){return 0==this._queueAbleMetrics.length&&this._unloadQueueObj.queue.length>0}},EBG.declareClass(EBG.VV.Reporting.UnloadQueueReporter,EBG.VV.Reporting.Reporter),EBG.VV.Reporting.SamuraiReporter=function(t,e){this.formatter=new EBG.VV.Reporting.SamuraiFormatter(e),this.whitelist=["metrics"],this.manager=t,this._init()},EBG.VV.Reporting.SamuraiReporter.prototype={_init:function(){},_handle:function(t){return EBG.indexOfArray(this.whitelist,t.metric.metricName)>-1&&t}},EBG.declareClass(EBG.VV.Reporting.SamuraiReporter,EBG.VV.Reporting.Reporter),EBG.VV.Reporting.SamuraiFormatter=function(t){this.baseURL=this._getProtocol(t)+"//"+t.config.logCollectorURL},EBG.VV.Reporting.SamuraiFormatter.prototype={format:function(t){return{url:this.baseURL,data:t=JSON.stringify(t.metric.value)}}},EBG.declareClass(EBG.VV.Reporting.SamuraiFormatter,EBG.VV.Reporting.Formatter),EBG.declareNamespace("VV.Target"),EBG.VV.Target.ConfigManager=function(t,e,i){this.shared=e,this.target=t,this.config.ebO=i||null,this.init()},EBG.VV.Target.ConfigManager.prototype={config:{ebO:null,adId:-1,sessionId:-1,thresholds:{},useAPI:!1,timestamp:0},rules:[{find:"sid",rx:/sid:"*(.*?)"*,/,configPropName:"sessionId",defaultValue:"0"},{find:"sessionid",configPropName:"sessionId",defaultValue:"0"},{find:"adId",rx:/adId:"*(.*?)"*,/,configPropName:"adId"},{find:"adID",configPropName:"adId"},{find:"aid",configPropName:"adId"},{find:"usercookie",rx:/usercookie:"*(.*?)"*,/,configPropName:"usercookie",defaultValue:"0"},{find:"u2",configPropName:"usercookie",defaultValue:"0"},{find:"diappid",configPropName:"diappid",defaultValue:-1},{find:"oo",rx:/oo:(.*?),/,configPropName:"optOut",defaultValue:"0"},{find:"isInstream",rx:/isInstream:(.*?),/,configPropName:"isInstream",forceType:EBG.VV.Type.BOOLEAN,defaultValue:!1},{find:"IABBV",rx:/IABBV:(.*?),/,configPropName:"viewabilityBasicMode",forceType:EBG.VV.Type.BOOLEAN,defaultValue:!0},{find:"IABEV",rx:/IABEV:(.*?),/,configPropName:"viewabilityEnhancedMode",forceType:EBG.VV.Type.BOOLEAN,defaultValue:!0},{find:"IABMS",rx:/IABMS:(.*?),/,thresholdPropName:"IABSurface",multiplier:.01,defaultValue:.5,useDefaultIf:""},{find:"IABMD",rx:/IABMD:(.*?),/,thresholdPropName:"IABDuration",multiplier:1e3,useDefaultIf:""},{find:"AgMS",rx:/AgMS:(.*?),/,thresholdPropName:"AgencySurface",multiplier:.01,useDefaultIf:""},{find:"AgMD",rx:/AgMD:(.*?),/,thresholdPropName:"AgencyDuration",multiplier:1e3,useDefaultIf:""},{find:"AdMS",rx:/AdMS:(.*?),/,thresholdPropName:"AdvertiserSurface",multiplier:.01,useDefaultIf:""},{find:"AdMD",rx:/AdMD:(.*?),/,thresholdPropName:"AdvertiserDuration",multiplier:1e3,useDefaultIf:""},{find:"cu",rx:/cu:(.*?),/,configPropName:"collectURL",forceType:EBG.VV.Type.BOOLEAN,defaultValue:!0},{find:"advid",rx:/advid:"*(.*?)"*,/,configPropName:"advertiserId",defaultValue:"0"},{find:"pli",rx:/placementId:"*(.*?)"*,/,configPropName:"placementId",defaultValue:"0"},{find:"placementId",configPropName:"placementId",defaultValue:"0"},{find:"placementID",configPropName:"placementId",defaultValue:"0"},{find:"isClick",configPropName:"sendClickTracking",forceType:EBG.VV.Type.BOOLEAN,defaultValue:!1},{find:"lcu",configPropName:"logCollectorURL"},{find:"rdi",configPropName:"rdi",defaultValue:0},{find:"reportingFF",configPropName:"featureFlags",defaultValue:{}},{find:"agid",configPropName:"agencyId",defaultValue:0},{find:"ebPtcl",configPropName:"protocol"},{find:"reportHost",configPropName:"reportHost"},{find:"handleStartTime",configPropName:"handleStartTime"},{find:"src",configPropName:"source"},{find:"seg",configPropName:"seg"}],init:function(){if(this.config.timestamp=EBG.getTime(!0),this.config.ebO)this.getConfigFromEbO();else{var t=this.shared.detectionManager.getDetector(EBG.VV.DetectionTypes.QUERY_STRING,this.target);t.getValue(EBG.VV.Tokens.SZMKVVQueryString.CONFIG_URL)?this.requestConfigFromServer():(this.config.useAPI=!0,this.config.protocol=t.getValue("protocol"),this.config.hostname=t.getValue("hostname"))}},getConfig:function(){return this.config},_configReady:function(){this.target.configReadyCallback()},hasServerConfig:function(){return!!(this.config.sessionId&&this.config.adId&&EBG.isDefined(this.config.usercookie)&&EBG.isDefined(this.config.optOut))},requestConfigFromServer:function(){var t=this.shared.detectionManager.getDetector(EBG.VV.DetectionTypes.QUERY_STRING,this.target).getValue(EBG.VV.Tokens.SZMKVVQueryString.CONFIG_URL);t&&this.shared.reporter.send({url:decodeURIComponent(t),data:void 0},this.receiveConfigFromServer.bind(this),!0)},receiveConfigFromServer:function(t){var e=this.config;try{var i=JSON.parse(t,(function(t,e){for(var i=0;i<this.rules.length;i++){var r=this.rules[i];if(t==r.find){r.multiplier&&(e*=r.multiplier);var n=r.thresholdPropName||r.configPropName;if(this[n]=e,r.json!=n)return}}return e}));EBG.mergeObj(i,e,!0)}catch(o){for(i=0;i<this.rules.length;i++){var r=this.rules[i],n=r.rx.exec(t),s=r.multiplier||1;r.prop?e[r.prop]=n&&EBG.isDefined(n[1])?n[1].trim():void 0:r.thresholdProp&&(n=n&&EBG.isDefined(n[1])?n[1].trim():void 0,EBG.isNumber(n)&&(n*=s),e.thresholds[r.thresholdProp]=n)}}e.viewabilityBasicMode=Boolean(e.viewabilityBasicMode),e.viewabilityEnhancedMode=Boolean(e.viewabilityEnhancedMode),e.optOut=Boolean(e.optOut),e.isInstream=Boolean(e.isInstream),e.collectURL=Boolean(e.collectURL),this._configReady()},_setConfigProp:function(t,e){var i=this.config,r=e[t.find];if(r!=t.useDefaultIf&&EBG.isDefined(r)){if(t.forceType&&t.forceType==EBG.VV.Type.BOOLEAN&&("false"!=r&&"0"!=r||(r=!1),r=Boolean(r)),t.configPropName)i[t.configPropName]=r;else if(t.thresholdPropName){var n=t.multiplier||1;EBG.isNumber(r)&&(i.thresholds[t.thresholdPropName]=r*n)}}else EBG.isDefined(t.defaultValue)&&(t.thresholdPropName?i.thresholds[t.thresholdPropName]=t.defaultValue:t.configPropName&&(i[t.configPropName]=t.defaultValue))},getConfigFromEbO:function(){for(var t=this.config,e=this.shared.detectionManager.getDetector(EBG.VV.DetectionTypes.QUERY_STRING,this.target),i=0;i<this.rules.length;i++){var r=this.rules[i];EBG.isDefined(t.ebO[r.find])?this._setConfigProp(r,t.ebO):t.ebO.adConfig&&EBG.isDefined(t.ebO.adConfig[r.find])?this._setConfigProp(r,t.ebO.adConfig):this._setConfigProp(r,{})}t.sessionId=t.sessionId||e.getValue(EBG.VV.Tokens.SZMKVVQueryString.SESSION_ID),t.adId=t.adId||e.getValue(EBG.VV.Tokens.SZMKVVQueryString.AD_ID)},getConfigFromSharedData:function(t){for(var e=0;e<this.rules.length;e++){var i=this.rules[e];EBG.isDefined(t.vendorData[i.find])?this._setConfigProp(i,t.vendorData):EBG.isDefined(t.adData[i.find])?this._setConfigProp(i,t.adData):EBG.isDefined(this.config[i.configPropName])||this._setConfigProp(i,{})}this._configReady()}},EBG.VV.Target.TargetGroup=function(t,e,i){this.shared=t,this.detectionManager=t.detectionManager,this.metricsManager=t.metricsManager,this.targetAdapter=this._getAdapter(),this.targets=[],this.id=e,this.group=this,this.init(i)},EBG.VV.Target.TargetGroup.prototype={targetAdapter:null,targetType:EBG.VV.TargetType.TARGET_GROUP,id:null,uid:null,group:null,targetAPIDetector:null,targets:null,adData:null,index:null,sharedData:null,isServiceInitted:!1,config:{},_targetSubscriptions:[],init:function(t){this.configManager=new EBG.VV.Target.ConfigManager(this,this.shared,t),this.config=this.configManager.getConfig(),this.setUID()},destroy:function(){for(var t=this.targets.length-1;t>-1;t--)EBG.isFunc(this.targets[t].destroy)&&this.targets[t].destroy();this.targetAdapter.destroy()},setUID:function(){-1==this.config.sessionId||this.uid||(this.uid=this.id+"_"+this.config.sessionId)},hasServerConfig:function(){return this.configManager.hasServerConfig()},configReadyCallback:function(){this.config=this.configManager.getConfig(),this.setUID(),this.isServiceInitted&&this.hasServerConfig()&&this.vendorReady()},addTarget:function(t,e){for(var i=0;i<this.targets.length;i++)if(this.targets[i].element==t)return!1;this.targets.push(new EBG.VV.Target.TargetEntity(t,this,this.shared,e))},_getAdapter:function(){return this.targetAdapter||new EBG.VV.Target.VPAIDVerificationAdapter(this)},initService:function(t){if(!this.isServiceInitted){if(t&&t.adData&&!t.adData.adID||(!t.slots||!t.slots.videoSlot)&&(!t.targets||!t.targets.primary||!t.targets.primary.length))return console.error("TargetGroup.initService: invalid sharedData. Missing adID, videoSlot, or target"),!1;if(this.sharedData=t,this.config.useAPI&&this.configManager.getConfigFromSharedData(t),!this.hasServerConfig())return console.error("TargetGroup.initService: failed to get required config data adId and/or sessionId"),!1;if(this.config.thresholds.IABDuration=EBG.isDefined(this.config.thresholds.IABDuration)?this.config.thresholds.IABDuration:this.isInstream()?2e3:1e3,this.metricsManager.addMetricsForTarget(this),this.targetAPIDetector=this.detectionManager.addDetectorsForTarget(this)[EBG.VV.DetectionTypes.TARGET_API],this.config.isInstream){var e=EBG.isValidVideoElement(t.slots.videoSlot)?t.slots.videoSlot:t.slots.slot;this.addTarget(e,!0),t=e==t.slots.videoSlot?t.slots.slot:t.slots.videoSlot,EBG.isHtmlElement(t)&&this.addTarget(t,!1)}else{if(t.targets&&t.targets.primary&&t.targets.primary.length)for(e=0;e<t.targets.primary.length;e++)this.addTarget(t.targets.primary[e],0==e);if(t.targets&&t.targets.secondary&&t.targets.secondary.length)for(e=0;e<t.targets.secondary.length;e++);}if(this.targets.length>1)for(e=0;e<this.targets.length;e++)this.detectionManager.startDetectorsForTarget(this.targets[e]);this.detectionManager.startDetectorsForTarget(this),this.isServiceInitted=!0,this.hasServerConfig()&&this.vendorReady()}},isInstream:function(){var t=Boolean(this.config.isInstream);return!t&&this.sharedData&&(t=this.config.isInstream=EBG.isValidVideoElement(this.sharedData.slots&&this.sharedData.slots.videoSlot)),t},vendorReady:function(){for(var t=0;t<this._targetSubscriptions.length;t++)"VendorReady"==this._targetSubscriptions[t].type&&this._targetSubscriptions[t].callback.call(this,{type:"VendorReady"})},getInstructions:function(){return{adBlocking:"AllowAd"}},update:function(t){this.targetAPIDetector.update(t)},subscribe:function(t,e){this._targetSubscriptions.push({type:t,callback:e})},notifyTarget:function(){}},EBG.VV.Target.TargetEntity=function(t,e,i,r){this.element=t,this.shared=i,this.metricsManager=i.metricsManager,this.detectionManager=i.detectionManager,this.id=EBG.generateID(),this.group=e,this.shouldReportMetrics=Boolean(r),this.init()},EBG.VV.Target.TargetEntity.prototype={element:null,targetType:EBG.VV.TargetType.TARGET_ENTITY,id:null,group:null,shouldReportMetrics:!0,inUnfriendlyIframe:null,ownerWindow:null,ownerDocument:null,topAccessibleWindow:null,_windowRect:null,init:function(){var t=this.element.ownerDocument;this.ownerDocument=t;var e=this.ownerWindow=t.defaultView||t.parentWindow||window,i=!0;if(t=function(){this.parent&&this.parent==window.top&&(i=!1),e=this},EBG.walkUpIframes(t,null,this.ownerWindow,!1),!i)try{Boolean(window.top.document)}catch(t){i=!0}this.inUnfriendlyIframe=!1,EBG.walkUpIframes(t,null,this.ownerWindow,!0),this.topAccessibleWindow=e,this.shouldReportMetrics&&this.metricsManager.addMetricsForTarget(this),this.detectionManager.addDetectorsForTarget(this)},destroy:function(){},getWidth:function(){return this.getBoundingClientRect().width},getHeight:function(){return this.getBoundingClientRect().height},getBoundingClientRect:function(t){t=t||{};var e=this.element.getBoundingClientRect();if((e={width:Math.round(e.width),height:Math.round(e.height),top:Math.round(e.top),left:Math.round(e.left),bottom:Math.round(e.bottom),right:Math.round(e.right)}).width=EBG.isNumber(e.width)?e.width:e.right-e.left,e.height=EBG.isNumber(e.height)?e.height:e.bottom-e.top,t.clip&&this.ownerWindow.getComputedStyle)try{if(o=/rect\((.*?)px(.*?)px(.*?)px(.*?)px\)/g.exec(this.ownerWindow.getComputedStyle(this.element).getPropertyValue("clip"))){for(var i=1;i<o.length;i++)o[i]=parseFloat(o[i].replace(",",""));if(o[1]+o[2]+o[3]+o[4]!=0){var r={top:e.top+o[1],left:e.left+o[4]};r.right=Math.min(r.left+(o[2]-o[4]),e.right),r.bottom=Math.min(r.top+(o[3]-o[1]),e.bottom),r.width=r.right-r.left,r.height=r.bottom-r.top,e=r}}}catch(t){}if(t.relativeToTop){var n=0,s=0,o=this.ownerWindow,a=1,c=1;EBG.walkUpIframes((function(){if(this.frameElement){var t=this.frameElement.getBoundingClientRect();a*=t.width/this.innerWidth,c*=t.height/this.innerHeight,n+=t.top,s+=t.left}}),null,o),e.top+=n,e.left+=s,e.bottom+=n,e.right+=s,e.width*=a,e.height*=c,e.left*=a,e.right*=a,e.top*=c,e.bottom*=c}return t.relativeToWindow&&(t=(o=this.ownerWindow).pageXOffset||o.document.documentElement.scrollLeft,o=o.pageYOffset||o.document.documentElement.scrollTop,e.top+=o,e.left+=t,e.bottom+=o,e.right+=t),e}},EBG.VV.Target.TargetPage={targetType:EBG.VV.TargetType.PAGE},EBG.VV.Target.VPAIDVerificationAdapter=function(t){window.vendorAdapter=this,this.targetGroup=t,this.scope=window},EBG.VV.Target.VPAIDVerificationAdapter.prototype={api:null,getAPI:function(){return this.api=this.api||new EBG.VV.Target.VPAIDVerificationAPI(this.targetGroup)},destroy:function(){this.api=null},getAPIScope:function(){return this.scope}},EBG.VV.Target.VPAIDVerificationAPI=function(t){this.targetGroup=t},EBG.VV.Target.VPAIDVerificationAPI.prototype={targetGroup:null,version:"1.0.0",handshakeVersion:function(){return this.version},initService:function(t){this.targetGroup.initService(t)},getInstructions:function(){return this.targetGroup.getInstructions()},update:function(t){return this.targetGroup.update(t)},subscribe:function(t,e){return this.targetGroup.subscribe(t,e)}},EBG.declareNamespace("VV.Detection"),EBG.VV.Detection.DetectionManager=function(t){this.shared=t,this.detectors=[],this.init()},EBG.VV.Detection.DetectionManager.prototype={shared:null,detectors:[],init:function(){this.addDetectorsForTarget(EBG.VV.Target.TargetPage)},destroy:function(){for(var t=this.detectors.length-1;t>=0;t--)this.detectors[t].destroy()},addDetectorsForTarget:function(t){if(t.targetType==EBG.VV.TargetType.TARGET_ENTITY)return this._addTargetEntityDetectors(t);for(var e={},i=this._getDetectorClassesByTargetType(t.targetType),r=0;r<i.length;r++){var n=this.getDetector(i[r].prototype.type,t);n&&(e[n.type]=n)}return e},_addTargetEntityDetectors:function(t){var e=this.shared,i={};return t.targetType==EBG.VV.Detection.ViewabilityDetectorFactory.prototype.targetType&&(e=new EBG.VV.Detection.ViewabilityDetectorFactory(t,e).getDetector())&&(this.detectors.push(e),i[e.type]=e),(e=this._addDetector(EBG.VV.Detection.OverlapDetector,t))&&(i[e.type]=e),(e=this._addDetector(EBG.VV.Detection.ScreenRectDetector,t))&&(i[e.type]=e),i},_addDetector:function(t,e){if(t.prototype.targetType==e.targetType){var i=new t(e,this.shared);return this.detectors.push(i),i}},startDetectorsForTarget:function(t){t=this.getDetectorsByTarget(t);for(var e=0;e<t.length;e++)t[e].start()},requestDetectionsForTarget:function(t){t=this.getDetectorsByTarget(t);for(var e=0;e<t.length;e++)t[e].detect()},getDetectorsByType:function(t){return this._getDetectorsByClass(EBG.VV.DetectionTypes,t)},getDetectorsByTarget:function(t){return this._getDetectorsByClass(EBG.VV.Target,t)},getDetector:function(t,e){var i,r=this._getDetectorsByClass(EBG.VV.DetectionTypes,t);return(r=this._getDetectorsByClass(EBG.VV.Target,e,r))[0]||(i=this._getDetectorClassByDetectionType(t))&&(r[0]=this._addDetector(i,e)),r[0]},_getDetectorClassByDetectionType:function(t){var e,i=[];for(e in EBG.VV.Detection)EBG.VV.Detection.hasOwnProperty(e)&&EBG.VV.Detection[e].prototype.type&&EBG.VV.Detection[e].prototype.type==t&&i.push(EBG.VV.Detection[e]);return!(i.length>1)&&i[0]},_getDetectorClassesByTargetType:function(t){var e,i=[];for(e in EBG.VV.Detection){var r=EBG.VV.Detection[e];r.prototype.targetType&&r.prototype.targetType==t&&i.push(r)}return i},_getDetectorsByClass:function(t,e,i){var r=[],n="";switch(i=i||this.detectors,t){case EBG.VV.DetectionTypes:n="type";break;case EBG.VV.Target:n="target";break;default:return null}for(t=0;t<i.length;t++)i[t][n]==e&&r.push(i[t]);return r}},EBG.declareClass(EBG.VV.Detection.DetectionManager,null),EBG.VV.Detection.DetectionData=function(t,e,i,r){this.type=t,this.value=EBG.isDefined(i)?i:e.getValue(t),this.timestamp=EBG.getTime(!0),this.target=EBG.isDefined(e.target)?e.target:void 0,this.userInitiated=Boolean(r)},EBG.VV.Detection.DetectionData.prototype={type:"",value:0,timestamp:0,target:null,userInitiated:!1},EBG.VV.Detection.Detector=function(t,e){this.metricsManager=e.metricsManager,this.shared=e,t&&this.setTarget(t),this.init()},EBG.VV.Detection.Detector.prototype={target:null,targetType:null,value:null,type:null,started:!1,setTarget:function(t){this.target=t},init:function(){this.start()},start:function(){this.started||(this.started=!0,this.detect())},detect:function(){this.metricsManager.update(new EBG.VV.Detection.DetectionData(this.type,this))},getValue:function(){return this.value},destroy:function(){}},EBG.declareClass(EBG.VV.Detection.Detector,null),EBG.VV.Detection.QueryStringDetector=function(t,e){EBG.callSuperConstructor(EBG.VV.Detection.QueryStringDetector,this,[t,e])},EBG.VV.Detection.QueryStringDetector.prototype={type:EBG.VV.DetectionTypes.QUERY_STRING,targetType:EBG.VV.TargetType.TARGET_GROUP,_scriptTag:null,_scriptFileName:"SZMKVV.js",init:function(){this._scriptTag=this._getScriptTag(),EBG.callSuperFunction(EBG.VV.Detection.QueryStringDetector,this,"init")},detect:function(){if(this._scriptTag&&this._scriptTag.src){var t=this._scriptTag.src.match(/\?([^#]*)(#.*)?/);(t=this._parse(t&&t[1]||"")).hasOwnProperty("")||(this.value=t),t.hasOwnProperty("protocol")||(this.value=this.value||{},this.value.protocol=this._scriptTag.src.split("://")[0]+"://"),t.hasOwnProperty("hostname")||(this.value=this.value||{},t=(t=(t=(t=this._scriptTag.src.split("://")[1]).split("/")[0]).split(":")[0]).split("?")[0],this.value.hostname=t)}EBG.callSuperFunction(EBG.VV.Detection.QueryStringDetector,this,"detect")},_getScriptTag:function(){for(var t=RegExp(this._scriptFileName.replace(".","\\.")+"(\\?.*)?$"),e=document.getElementsByTagName("script"),i=0;i<e.length;i++){var r=e[i];if(r.src&&r.src.match(t)&&"true"!=r.getAttribute("data-used"))return r.setAttribute("data-used","true"),r}},_parse:function(t){for(var e={},i=(t=t.split("&"),0);i<t.length;i++){var r=(n=t[i].split("="))[0],n=n[1];e[r]=EBG.isDefined(e[r])?e[r]:n}return e},getValue:function(t){var e=this.value;return this.value&&t&&this.value[t]?e=this.value[t]:!t||t==this.type||this.value&&this.value[t]||(e=""),e}},EBG.declareClass(EBG.VV.Detection.QueryStringDetector,EBG.VV.Detection.Detector),EBG.VV.Detection.PageVisibilityDetector=function(t,e){this.drm=i,EBG.callSuperConstructor(EBG.VV.Detection.PageVisibilityDetector,this,[t,e])},EBG.VV.Detection.PageVisibilityDetector.prototype={type:EBG.VV.DetectionTypes.PAGE_VISIBILITY,targetType:EBG.VV.TargetType.PAGE,hidden:"",visibilityChange:"",init:function(){void 0!==document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):void 0!==document.msHidden?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):void 0!==document.webkitHidden&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),EBG.callSuperFunction(EBG.VV.Detection.PageVisibilityDetector,this,"init")},start:function(){void 0!==document.addEventListener&&void 0!==document[this.hidden]&&(this.value=!document[this.hidden],this.started||(this.eventHandler=EBG.idleCallback(this.handleVisibilityChange.bind(this)),document.addEventListener(this.visibilityChange,this.eventHandler,!1))),EBG.callSuperFunction(EBG.VV.Detection.PageVisibilityDetector,this,"start"),this.handleVisibilityChange()},handleVisibilityChange:function(){this.value=!document[this.hidden],this.drm.p={v:this.value},this.detect()},destroy:function(){this.started&&document.removeEventListener(this.visibilityChange,this.eventHandler,!1)}},EBG.declareClass(EBG.VV.Detection.PageVisibilityDetector,EBG.VV.Detection.Detector),EBG.VV.Detection.PageUnloadDetector=function(t,e){EBG.callSuperConstructor(EBG.VV.Detection.PageUnloadDetector,this,[t,e])},EBG.VV.Detection.PageUnloadDetector.prototype={type:EBG.VV.DetectionTypes.PAGE_UNLOAD,targetType:EBG.VV.TargetType.PAGE,start:function(){this.eventHandler=this.detect.bind(this),this.unloaded=!1,window.addEventListener("beforeunload",this.eventHandler,!1),window.addEventListener("unload",this.eventHandler,!1),window.addEventListener("pagehide",this.eventHandler,!1)},detect:function(t){this.unloaded||!t||"unload"!=t.type&&"beforeunload"!=t.type&&"pagehide"!=t.type||(EBG.callSuperFunction(EBG.VV.Detection.PageUnloadDetector,this,"detect"),this.handleUnload(),this.unloaded=!0)},handleUnload:function(){try{EBG.vv.destroy()}catch(t){}},destroy:function(){window.removeEventListener("unload",this.eventHandler,!1)}},EBG.declareClass(EBG.VV.Detection.PageUnloadDetector,EBG.VV.Detection.Detector),EBG.VV.Detection.TargetAPIDetector=function(t,e){this.targetAPI=t,EBG.callSuperConstructor(EBG.VV.Detection.TargetAPIDetector,this,[t,e])},EBG.VV.Detection.TargetAPIDetector.prototype={type:EBG.VV.DetectionTypes.TARGET_API,targetType:EBG.VV.TargetType.TARGET_GROUP,_prevAdVolume:null,_viewMode:null,init:function(){},update:function(t){var e=this.getValue(t.type,t),i=this.getIsUserInit(t.type,t),r=new EBG.VV.Detection.DetectionData(t.type,this,e,i);this.metricsManager.update(r),EBG.isDefined(t.data.adData.adVolume)&&this._prevAdVolume!=t.data.adData.adVolume&&t.data.adData.adVolume>-1&&(this._prevAdVolume=t.data.adData.adVolume,e=this.getValue(EBG.VV.DetectionTypes.AD_VOLUME_CHANGE,t),r=new EBG.VV.Detection.DetectionData(EBG.VV.DetectionTypes.AD_VOLUME_CHANGE,this,e,i),this.metricsManager.update(r)),EBG.isDefined(t.data.adData.viewMode)&&this._viewMode!=t.data.adData.viewMode&&(this._viewMode=t.data.adData.viewMode,e=this.getValue(EBG.VV.DetectionTypes.AD_FULLSCREEN_CHANGE,t),r=new EBG.VV.Detection.DetectionData(EBG.VV.DetectionTypes.AD_FULLSCREEN_CHANGE,this,e,i),this.metricsManager.update(r)),t.type!=EBG.VV.DetectionTypes.AD_ERROR&&t.type!=EBG.VV.DetectionTypes.AD_SKIPPED&&t.type!=EBG.VV.DetectionTypes.AD_STOPPED||(r=new EBG.VV.Detection.DetectionData(EBG.VV.DetectionTypes.AD_UNLOAD,this,e,i),this.metricsManager.update(r),EBG.vv.destroy())},detect:function(){},getValue:function(t,e){var i=0;switch(t){case EBG.VV.DetectionTypes.AD_INTERACTION:i=0;break;case EBG.VV.DetectionTypes.AD_ERROR:i=e.data.eventData.message;break;case EBG.VV.DetectionTypes.AD_VOLUME_CHANGE:i=Number(e.data.adData.adVolume);break;case EBG.VV.DetectionTypes.AD_FULLSCREEN_CHANGE:i=this._viewMode;break;case EBG.VV.DetectionTypes.AD_SIZE_CHANGE:i={width:e.data.adData.adWidth,height:e.data.adData.adHeight};break;default:i=null}return i},getIsUserInit:function(t){var e=!1;return t===EBG.VV.DetectionTypes.CLICK&&(e=!0),e}},EBG.declareClass(EBG.VV.Detection.TargetAPIDetector,EBG.VV.Detection.Detector),EBG.VV.Detection.ViewabilityDetectorFactory=function(t,e){EBG.callSuperConstructor(EBG.VV.Detection.ViewabilityDetectorFactory,this,[t,e])},EBG.VV.Detection.ViewabilityDetectorFactory.prototype={type:EBG.VV.DetectionTypes.VIEWABILITY_RECORDABLE,targetType:EBG.VV.TargetType.TARGET_ENTITY,init:function(){},getDetector:function(){var t;if(this.target.inUnfriendlyIframe?window.IntersectionObserver?t=EBG.VV.Detection.IntersectionViewabilityDetector:"function"==typeof document.body.componentFromPoint&&(t=EBG.VV.Detection.GridViewabilityDetector):t=EBG.VV.Detection.IntersectionViewabilityDetector,t)var e=new t(this.target,this.shared);return this.value=Boolean(e),this.target=this.target.group,this.detect(),e}},EBG.declareClass(EBG.VV.Detection.ViewabilityDetectorFactory,EBG.VV.Detection.Detector),EBG.VV.Detection.ViewabilityDetectorBase=function(t,e){this.metricsManager=e.metricsManager,EBG.callSuperConstructor(EBG.VV.Detection.ViewabilityDetectorBase,this,[t,e])},EBG.VV.Detection.ViewabilityDetectorBase.prototype={type:EBG.VV.DetectionTypes.VIEWABLE_RATIO,targetType:EBG.VV.TargetType.TARGET_ENTITY,element:null,_viewableRatio:0,_screenShareRatio:0,_screenRect:null,_intersectionRect:null,pollingInterval:100,_interval:null,init:function(){0==this.target.shouldReportMetrics&&(this.pollingInterval=1e3),EBG.callSuperFunction(EBG.VV.Detection.ViewabilityDetectorBase,this,"init")},start:function(){this.started||(this._interval=setInterval(EBG.idleCallback(this.detect.bind(this)),this.pollingInterval),EBG.callSuperFunction(EBG.VV.Detection.ViewabilityDetectorBase,this,"start"))},stop:function(){this.started=!1,clearInterval(this._interval)},setTarget:function(t){EBG.callSuperFunction(EBG.VV.Detection.ViewabilityDetectorBase,this,"setTarget",[t]),this.element=t.element},getViewableRatio:function(){return this._viewableRatio},getScreenShareRatio:function(){var t=-1;return(this.target.isUnfriendlyIframe||null==this._screenRect)&&(this._screenRect=this.shared.detectionManager.getDetector(EBG.VV.DetectionTypes.WINDOW_RECT,this.target.group).getValue()),this._screenRect&&this._intersectionRect&&(t=this._intersectionRect.width*this._intersectionRect.height/(this._screenRect.width*this._screenRect.height)),this._screenShareRatio=t},detect:function(){this.metricsManager.update(new EBG.VV.Detection.DetectionData(EBG.VV.DetectionTypes.VIEWABLE_RATIO,this)),this.metricsManager.update(new EBG.VV.Detection.DetectionData(EBG.VV.DetectionTypes.SCREENSHARE_RATIO,this))},getValue:function(t){var e=0;switch(t){case EBG.VV.DetectionTypes.VIEWABLE_RATIO:e=this.getViewableRatio();break;case EBG.VV.DetectionTypes.SCREENSHARE_RATIO:e=this.getScreenShareRatio()}return e},destroy:function(){this.stop()},notifyViewableReported:function(){this.pollingInterval=500,this.stop(),this.start()}},EBG.declareClass(EBG.VV.Detection.ViewabilityDetectorBase,EBG.VV.Detection.Detector),EBG.VV.Detection.IntersectionViewabilityDetector=function(t,e){EBG.callSuperConstructor(EBG.VV.Detection.IntersectionViewabilityDetector,this,[t,e])},EBG.VV.Detection.IntersectionViewabilityDetector.prototype={_observer:null,start:function(){this._observer.observe(this.element),EBG.callSuperFunction(EBG.VV.Detection.IntersectionViewabilityDetector,this,"start")},init:function(){this._observer=new this.target.topAccessibleWindow.IntersectionObserver(this._handleChanges.bind(this),{threshold:[0,.05,.1,.15,.2,.25,.3,.35,.4,.45,.5,.55,.6,.65,.7,.75,.8,.85,.9,.95,1]}),EBG.callSuperFunction(EBG.VV.Detection.IntersectionViewabilityDetector,this,"init")},_handleChanges:function(t){t=t[t.length-1],this._viewableRatio=Math.min(t.intersectionRatio,1),this._intersectionRect=t.intersectionRect,this.detect()},notifyViewableReported:function(){clearInterval(this._interval),EBG.callSuperFunction(EBG.VV.Detection.IntersectionViewabilityDetector,this,"notifyViewableReported")},destroy:function(){this._observer.disconnect(),EBG.callSuperFunction(EBG.VV.Detection.IntersectionViewabilityDetector,this,"destroy")}},EBG.declareClass(EBG.VV.Detection.IntersectionViewabilityDetector,EBG.VV.Detection.ViewabilityDetectorBase),EBG.VV.Detection.Grid=function(t,e){this.target=t,this.gridPointsCount=EBG.isDefined(e)?e:this.gridPointsCount,this.init()},EBG.VV.Detection.Grid.prototype={target:null,gridPointsCount:64,length:0,init:function(){this._calculateGridPoints()},update:function(){Array.prototype.splice.call(this,0,this.length),this._calculateGridPoints()},_calculateGridPoints:function(){this.gridPointsCount>10?this._regularGrid():this._xGrid()},_regularGrid:function(){var t,e=Math.sqrt(this.gridPointsCount),i=(t=this.target.getBoundingClientRect()).width/t.height,r=Math.round(e*(1/i)),n=(e=Math.round(e*i),i=t.width/e,(t=t.height/r)/2);this.gridPointsCount=r*e;for(var s=i/2;s<e*i;s+=i)for(var o=n;o<r*t;o+=t)this._addPoint(Math.round(s),Math.round(o))},_diamondGrid:function(){var t,e,i,r=this.target.getBoundingClientRect(),n=this.gridPointsCount/2,s=(r.width-1)/(n-1),o=(r.height-1)/(n-1),a=Math.floor(r.height/2);for(i=0;i<n;i++)t=Math.floor(s*i),(e=a+Math.floor(o*i))>r.height&&(e-=r.height),this._addPoint(t,e),(e=a+Math.floor(o*(n-1-i)))>r.height&&(e-=r.height),this._addPoint(t,e)},_xGrid:function(){var t,e,i,r=this.target.getBoundingClientRect(),n=this.gridPointsCount/2,s=(r.width-1)/(n-1);for(r=(r.height-1)/(n-1),i=0;i<n;i++)t=Math.floor(s*i),e=Math.floor(r*i),this._addPoint(t,e),e=Math.floor(r*(n-1-i)),this._addPoint(t,e)},_addPoint:function(t,e){this.length<this.gridPointsCount&&Array.prototype.push.call(this,{x:t,y:e})}},EBG.declareClass(EBG.VV.Detection.Grid,null),EBG.VV.Detection.GridViewabilityDetector=function(t,e){EBG.callSuperConstructor(EBG.VV.Detection.GridViewabilityDetector,this,[t,e])},EBG.VV.Detection.GridViewabilityDetector.prototype={type:EBG.VV.DetectionTypes.VIEWABLE_RATIO,_targets:[],_offsets:{},_containerDiv:null,grid:null,init:function(){this.grid=new EBG.VV.Detection.Grid(this.target,64),this._createTargets(),this._positionTargets(),EBG.callSuperFunction(EBG.VV.Detection.GridViewabilityDetector,this,"init")},getScreenShareRatio:function(){var t=-1;return(this._screenRect=this.shared.detectionManager.getDetector(EBG.VV.DetectionTypes.WINDOW_RECT,this.target.group).getValue())&&this._containerDiv&&EBG.isDefined(this._containerDiv.clientWidth)&&(t=this._viewableRatio*this._containerDiv.clientWidth*this._containerDiv.clientHeight/(this._screenRect.width*this._screenRect.height)),this._screenShareRatio=t},_createTargets:function(){var t;t=this.target.ownerDocument.createElement("div");var e=this.target.getBoundingClientRect({relativeToWindow:!0});for(t.id="ebGridContainer_"+this.target.id,t.style.width=e.width+"px",t.style.height=e.height+"px",t.style.position="absolute",t.style.pointerEvents="none",t.style.left=this.target.element.offsetLeft+"px",t.style.top=this.target.element.offsetTop+"px",this._containerDiv=this.target.element.parentNode.appendChild(t),e=0;e<this.grid.gridPointsCount;e++)(t=document.createElement("div")).style.width="3px",t.style.height="3px",t.style.pointerEvents="none",t.style.position="absolute",t.id="ebGridDiv_"+e,this._containerDiv.appendChild(t),this._targets.push(t)},_checkPosition:function(){var t=this.target.getBoundingClientRect({relativeToWindow:!1});this._offsets.detectX=t.left,this._offsets.detectY=t.top,this._containerDiv.style.left=this.target.element.offsetLeft+"px",this._containerDiv.style.top=this.target.element.offsetTop+"px"},_positionTargets:function(){for(var t=0;t<this.grid.gridPointsCount;t++)this._targets[t].style.left=this.grid[t].x-1+"px",this._targets[t].style.top=this.grid[t].y-1+"px"},detect:function(){this._checkPosition();for(var t=0,e=0;e<this.grid.gridPointsCount;e++)t+=this.detectPoint(e);this.value=this._viewableRatio=t/this.grid.gridPointsCount,EBG.callSuperFunction(EBG.VV.Detection.GridViewabilityDetector,this,"detect")},detectPoint:function(t){var e=!1,i=(e=this.grid[t].x+this._offsets.detectX,this.grid[t].y+this._offsets.detectY);return this._targets[t].style.pointerEvents="auto",e="outside"!=this._targets[t].componentFromPoint(e,i),EBG.idleCallback(function(){this._targets[t].style.pointerEvents="none"}.bind(this)),e?1:0},destroy:function(){for(var t=0;t<this._targets.length;t++)this._targets[t].parentNode&&this._targets[t].parentNode.removeChild(this._targets[t]);this._containerDiv.parentNode.removeChild(this._containerDiv)}},EBG.VV.Detection.OverlapDetector=function(t,e){EBG.callSuperConstructor(EBG.VV.Detection.OverlapDetector,this,[t,e])},EBG.VV.Detection.OverlapDetector.prototype={type:EBG.VV.DetectionTypes.OVERLAP,targetType:EBG.VV.TargetType.TARGET_ENTITY,grid:null,pollingInterval:100,_numPoints:12,_interval:null,_whitelist:[],_pointerEventsList:[],init:function(){this.grid=this.target.group.config.featureFlags.RFF_FraudMetrics?this.target.getWidth()*this.target.getHeight()==0?new EBG.VV.Detection.Grid(this.target,0):new EBG.VV.Detection.Grid(this.target,this._numPoints):new EBG.VV.Detection.Grid(this.target,0)},start:function(){(this.target.inUnfriendlyIframe||window.parent==top)&&(this._interval=setInterval(EBG.idleCallback(this.detect.bind(this)),this.pollingInterval))},stop:function(){clearInterval(this._interval)},updateWhitelist:function(t){for(var e in t&&t instanceof t.ownerDocument.defaultView.HTMLElement&&-1==this._whitelist.indexOf(t)&&this._whitelist.push(t),this.target.group.targets)this.target.group.targets.hasOwnProperty(e)&&(t=this.target.group.targets[e].element,-1==this._whitelist.indexOf(t)&&this._whitelist.push(t))},detect:function(){if(this.grid.gridPointsCount>0){this.updateWhitelist();var t,e,i=0;for(e=0;e<this.grid.gridPointsCount;e++)(t=this.detectPoint(e))&&t.tagName&&"iframe"==t.tagName.toLowerCase()&&i++;for(this.value=i/this.grid.gridPointsCount;this._pointerEventsList.length>0;)(i=this._pointerEventsList.pop()).element.style.pointerEvents=i.previousValue;EBG.callSuperFunction(EBG.VV.Detection.OverlapDetector,this,"detect")}},detectPoint:function(t){var e,i=this.target.element,r=null,n=this.grid[t].x,s=this.grid[t].y,o=this;return EBG.walkUpIframes((function(){if(i&&!r){e=i.getBoundingClientRect(),n+=e.left,s+=e.top;var t=this.document.elementFromPoint(n,s);t&&t!=i&&(r=o._checkWhitelist(t)||o._isElementTransparent(t)?o._checkPointerEvents(n,s,i,t):t),i=this.frameElement}}),null,this.target.ownerWindow,!1),r},_checkWhitelist:function(t){for(var e=0;e<this._whitelist.length;e++)if(this._whitelist[e].contains(t))return!0;return!1},_checkPointerEvents:function(t,e,i,r){for(var n=r.ownerDocument,s=null;r!=i&&(this._pointerEventsList.push({element:r,previousValue:r.style.pointerEvents}),r.style.pointerEvents="none",(r=n.elementFromPoint(t,e))!=i&&r!=n.documentElement&&r!=n.body);)if(!this._isElementTransparent(r)&&!this._checkWhitelist(r)){s=r;break}return s},_invisibleProperties:{visibility:"hidden",display:"none",opacity:function(t){return 0==Number(t)},"background-color":function(t,e,i){var r=function(t){var e=t.replace(/^\s+|\s+$/g,"").match(/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i);return e&&0==Number(e[4])||"transparent"==t},n=e.innerText||e.textContent;return i=i.getPropertyValue("color"),r(t)&&-1==EBG.indexOfArray("object,canvas,video,source,track,iframe,embed,img".split(","),e.tagName.toLowerCase())&&(!n||r(i))}},_isElementTransparent:function(t){var e,i=t.ownerDocument.defaultView.getComputedStyle(t),r=this._invisibleProperties;for(e in r){var n=i.getPropertyValue(e);if(n)for(var s=r[e]instanceof Array?r[e]:[r[e]],o=0;o<s.length;o++)if(s[o]instanceof Function?s[o](n,t,i):n==s[o])return!0}return!1},destroy:function(){this.stop()}},EBG.declareClass(EBG.VV.Detection.OverlapDetector,EBG.VV.Detection.Detector),EBG.VV.Detection.ConcurrentTargetDetector=function(t,e){EBG.callSuperConstructor(EBG.VV.Detection.ConcurrentTargetDetector,this,[t,e])},EBG.VV.Detection.ConcurrentTargetDetector.prototype={type:EBG.VV.DetectionTypes.CONCURRENT_TARGET,targetType:EBG.VV.TargetType.TARGET_GROUP,init:function(){},start:function(){var t=this.target.targets[0].topAccessibleWindow;t.ebTargetList=t.ebTargetList||{},this.targetList=t.ebTargetList,this.targetList[this.target.uid]={startTime:EBG.getTime(),advertiserId:this.target.config.advertiserId,placementId:this.target.config.placementId,targetElem:this.target.targets[0].element,removed:!1},EBG.callSuperFunction(EBG.VV.Detection.ConcurrentTargetDetector,this,"start")},detect:function(){for(var t in this.targetList){var e=this.targetList[t];if(this.target.uid!=t&&e.targetElem){if(!e.removed)try{0==e.targetElem.getClientRects().length&&(e.removed=!0)}catch(t){e.removed=!0}this.metricsManager.update(new EBG.VV.Detection.DetectionData(EBG.VV.DetectionTypes.CONCURRENT_TARGET,this,{startTime:e.startTime,advertiserId:e.advertiserId,placementId:e.placementId,removed:e.removed}))}}},destroy:function(){this.targetList[this.target.uid].removed=!0}},EBG.declareClass(EBG.VV.Detection.ConcurrentTargetDetector,EBG.VV.Detection.Detector),EBG.VV.Detection.UserAgentDetector=function(t,e){EBG.callSuperConstructor(EBG.VV.Detection.UserAgentDetector,this,[t,e])},EBG.VV.Detection.UserAgentDetector.prototype={type:EBG.VV.DetectionTypes.USER_AGENT,targetType:EBG.VV.TargetType.PAGE,detect:function(){this.value=window.navigator.userAgent||window.navigator.vendor||window.opera,EBG.callSuperFunction(EBG.VV.Detection.UserAgentDetector,this,"detect")}},EBG.declareClass(EBG.VV.Detection.UserAgentDetector,EBG.VV.Detection.Detector),EBG.VV.Detection.AncestorsDetector=function(t,e){EBG.callSuperConstructor(EBG.VV.Detection.AncestorsDetector,this,[t,e])},EBG.VV.Detection.AncestorsDetector.prototype={type:EBG.VV.DetectionTypes.ANCESTOR_ORIGINS,targetType:EBG.VV.TargetType.TARGET_GROUP,value:[],init:function(){},detect:function(){this.target.targets&&this.target.targets[0]&&this.target.targets[0].ownerWindow&&this.target.targets[0].ownerWindow.location&&this.target.targets[0].ownerWindow.location.ancestorOrigins&&(this.value=this.target.targets[0].ownerWindow.location.ancestorOrigins||[]),EBG.callSuperFunction(EBG.VV.Detection.AncestorsDetector,this,"detect")}},EBG.declareClass(EBG.VV.Detection.AncestorsDetector,EBG.VV.Detection.Detector),EBG.VV.Detection.ScreenRectDetector=function(t,e){EBG.callSuperConstructor(EBG.VV.Detection.ScreenRectDetector,this,[t,e])},EBG.VV.Detection.ScreenRectDetector.prototype={type:EBG.VV.DetectionTypes.SCREEN_RECT,targetType:EBG.VV.TargetType.TARGET_ENTITY,detect:function(){var t=this.target.topAccessibleWindow;this.value={width:t.screen.width,height:t.screen.height},this.metricsManager.update(new EBG.VV.Detection.DetectionData(this.type,this,this.value))},getValue:function(){return this.detect(),this.value}},EBG.declareClass(EBG.VV.Detection.ScreenRectDetector,EBG.VV.Detection.Detector),EBG.VV.Detection.WindowRectDetector=function(t,e){EBG.callSuperConstructor(EBG.VV.Detection.WindowRectDetector,this,[t,e])},EBG.VV.Detection.WindowRectDetector.prototype={type:EBG.VV.DetectionTypes.WINDOW_RECT,targetType:EBG.VV.TargetType.TARGET_GROUP,_shouldUseOuterWidth:!0,_eventWindow:null,init:function(){var t=navigator.userAgent.toLowerCase();this._shouldUseOuterWidth=t.indexOf("android")<0&&t.indexOf("ios")<0&&t.indexOf("iphone")<0&&t.indexOf("ipad")<0&&EBG.isDefined(window.outerWidth)},start:function(){this._eventWindow=this.target.targets[0].topAccessibleWindow,this._subscribeToEvents(),EBG.callSuperFunction(EBG.VV.Detection.WindowRectDetector,this,"start")},_subscribeToEvents:function(){this.resizeHandler=EBG.idleCallback(this.detect.bind(this)),this._eventWindow.addEventListener("resize",this.resizeHandler,!1)},detect:function(){if(0==this.target.metricsManager.count())return this.destroy(),!0;this.value=this._shouldUseOuterWidth?{width:window.outerWidth,height:window.outerHeight}:this.target.targets[0].inUnfriendlyIframe?this.shared.detectionManager.getDetector(EBG.VV.DetectionTypes.SCREEN_RECT,this.target.targets[0]).getValue():{width:top.innerWidth,height:top.innerHeight},this.metricsManager.update(new EBG.VV.Detection.DetectionData(this.type,this,this.value))},getValue:function(){return this.started&&this.target.targets[0].inUnfriendlyIframe&&this.detect(),this.value},destroy:function(){this._eventWindow&&this._eventWindow.removeEventListener("resize",this.resizeHandler,!1)}},EBG.declareClass(EBG.VV.Detection.WindowRectDetector,EBG.VV.Detection.Detector),EBG.VV.Detection.ViewportRectDetector=function(t,e){EBG.callSuperConstructor(EBG.VV.Detection.ViewportRectDetector,this,[t,e])},EBG.VV.Detection.ViewportRectDetector.prototype={type:EBG.VV.DetectionTypes.VIEWPORT_RECT,targetType:EBG.VV.TargetType.TARGET_GROUP,_scrollbarWidth:null,_eventWindow:null,init:function(){},start:function(){this._scrollbarWidth=this._getScrollbarWidth(),this._eventWindow=this.target.targets[0].topAccessibleWindow,this._subscribeToEvents(),EBG.callSuperFunction(EBG.VV.Detection.ViewportRectDetector,this,"start")},_subscribeToEvents:function(){this.resizeHandler=EBG.idleCallback(this.detect.bind(this)),this._eventWindow.addEventListener("resize",this.resizeHandler,!1)},detect:function(){if(0==this.target.metricsManager.count())return this.destroy(),!0;var t={};if((e=this.target.targets[0]).inUnfriendlyIframe)t=this.shared.detectionManager.getDetector(EBG.VV.DetectionTypes.WINDOW_RECT,this.target).getValue();else{var e,i=(e=e.topAccessibleWindow).document;if(t.width=e.innerWidth,t.height=e.innerHeight,"hidden"!=i.body.style.overflow){(i.body.offsetWidth>t.width||i.body.scrollWidth>t.width||e.scrollMaxX>0)&&(t.height-=this._scrollbarWidth);var r=i.body.scrollHeight||i.documentElement.scrollHeight;(i.body.offsetHeight>t.height||r>t.height||e.scrollMaxY>0)&&(t.width-=this._scrollbarWidth)}}t.top=t.left=0,t.right=t.width,t.bottom=t.height,this.value=t,this.metricsManager.update(new EBG.VV.Detection.DetectionData(this.type,this,this.value))},_getScrollbarWidth:function(){var t=null,e=null,i=t=0,r=this.target.targets[0].topAccessibleWindow.document;return(t=r.createElement("div")).style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.width="100px",t.style.height="50px",t.style.overflow="auto",(e=r.createElement("div")).style.width="100%",e.style.height="200px",t.appendChild(e),r.body.appendChild(t),i=e.offsetWidth,r.body.removeChild(r.body.lastChild),t.style.overflow="hidden",r.body.appendChild(t),t=e.offsetWidth,r.body.removeChild(r.body.lastChild),t-i?t-i:0},getValue:function(){return this.started&&this.detect(),this.value},destroy:function(){this._eventWindow&&this._eventWindow.removeEventListener("resize",this.resizeHandler,!1)}},EBG.declareClass(EBG.VV.Detection.ViewportRectDetector,EBG.VV.Detection.Detector),EBG.declareNamespace("VV.Metrics"),EBG.declareNamespace("VV.Metrics.Classes"),EBG.declareNamespace("VV.Metrics.Definitions"),EBG.declareNamespace("VV.Metrics.Threshold"),EBG.VV.Metrics.MetricsManager=function(t){this.shared=t,this.reporter=t.reporter,this.metricsByTriggerType={},this.viewableMetricsNumber=0},EBG.VV.Metrics.MetricsManager.prototype={reporter:null,metricsByTriggerType:{},addMetricsForTarget:function(t){this._addSimpleMetricsForTarget(t),EBG.VV.Metrics.Threshold&&this._addThresholdMetricsForTarget(t),EBG.VV.Metrics.Classes.ViewableAverage&&this._addAverageMetricsForTarget(t),this.shared.detectionManager.requestDetectionsForTarget(EBG.VV.Target.TargetPage)},_addSimpleMetricsForTarget:function(t){var e,i=EBG.VV.Metrics.Classes,r=[];for(e in i){var n;i.hasOwnProperty(e)&&(n=i[e]).prototype&&""!=n.prototype.name&&n.prototype.targetType==t.targetType&&(n=new n(t,this.reporter.report.bind(this.reporter))).isValid()&&r.push(n)}this._addMetricsByTriggerType(r)},_addThresholdMetricsForTarget:function(t){var e=[],r=[{metricClass:EBG.VV.Metrics.Threshold.Viewable,metricName:"VsAg",thresholdProps:{surface:t.group.config.thresholds.AgencySurface,duration:t.group.config.thresholds.AgencyDuration}},{metricClass:EBG.VV.Metrics.Threshold.Duration,metricName:"VsAgDu",thresholdProps:{surface:t.group.config.thresholds.AgencySurface,duration:t.group.config.thresholds.AgencyDuration}},{metricClass:EBG.VV.Metrics.Threshold.Viewable,metricName:"VsAd",thresholdProps:{surface:t.group.config.thresholds.AdvertiserSurface,duration:t.group.config.thresholds.AdvertiserDuration}},{metricClass:EBG.VV.Metrics.Threshold.Duration,metricName:"VsAdDu",thresholdProps:{surface:t.group.config.thresholds.AdvertiserSurface,duration:t.group.config.thresholds.AdvertiserDuration}},{metricClass:EBG.VV.Metrics.Threshold.Viewable,metricName:"VsIAB",thresholdProps:{surface:t.group.config.thresholds.IABSurface,duration:t.group.config.thresholds.IABDuration}}],n=this.reporter.report.bind(this.reporter);r.forEach((function(r){t.targetType==r.metricClass.prototype.targetType&&EBG.isDefined(r.thresholdProps.surface)&&EBG.isDefined(r.thresholdProps.duration)&&e.push(new r.metricClass(t,n,r.thresholdProps.surface,r.thresholdProps.duration,r.metricName)),"VsIAB"==r.metricName&&(i.b={o:r})})),i.m={a:r[i.n].metricName,b:r[i.j].metricName,c:r[i.h].metricName},this._addMetricsByTriggerType(e),this.increase()},_addAverageMetricsForTarget:function(t){var e=EBG.VV.Metrics.Classes.ViewableAverage;if(t.targetType==e.prototype.targetType){var i=[],r=this.reporter.report.bind(this.reporter);i.push(new e(t,r,[EBG.VV.DetectionTypes.VIEWABLE_RATIO],"VsAvSu")),i.push(new e(t,r,[EBG.VV.DetectionTypes.SCREENSHARE_RATIO],"VsAvSc")),this._addMetricsByTriggerType(i)}},_addMetricsByTriggerType:function(t){var e=this;t.forEach((function(t){t.triggers.forEach((function(i){e.metricsByTriggerType[i]=e.metricsByTriggerType[i]||[],e.metricsByTriggerType[i].push(t)}))}))},update:function(t){for(var e in this.metricsByTriggerType[t.type]){var i=this.metricsByTriggerType[t.type][e];(t.target.targetType==EBG.VV.TargetType.PAGE||i.target==t.target||i.target.group==t.target)&&i.condition(t)&&i.report(t)}},destroy:function(){},increase:function(){this.viewableMetricsNumber++},decrease:function(){this.viewableMetricsNumber--},count:function(){return this.viewableMetricsNumber}},EBG.VV.Metrics.Classes.MetricBase=function(t,e){this.target=t,this.reportCallback=e,this.metricName=this.name,this.initConfig()},EBG.VV.Metrics.Classes.MetricBase.prototype={name:"",targetType:EBG.VV.TargetType.TARGET_GROUP,target:null,numLeft:1,includeDetectionValue:!1,value:0,isClick:!1,category:2,sendImmediately:!0,triggers:[],condition:function(){return!(this.numLeft<=0)},reportCallback:function(){},report:function(t){this.numLeft--,this.includeDetectionValue&&(this.value=t.value),this.reportCallback(this,t)},initConfig:function(){this.isValid()||(this.numLeft=0)},isUnique:function(){return Number(this.constructor.prototype.numLeft-this.numLeft==1)},isValid:function(){return Boolean(this.target.group.config.sessionId)}},EBG.declareClass(EBG.VV.Metrics.Classes.MetricBase,null),EBG.VV.Metrics.Classes.ViewableAverage=function(t,e,i,r){this.name=r,this.triggers=this.triggers.concat(i),EBG.callSuperConstructor(EBG.VV.Metrics.Classes.ViewableAverage,this,[t,e])},EBG.VV.Metrics.Classes.ViewableAverage.prototype={name:"",targetType:EBG.VV.TargetType.TARGET_ENTITY,triggers:[EBG.VV.DetectionTypes.PAGE_UNLOAD,EBG.VV.DetectionTypes.AD_UNLOAD,EBG.VV.DetectionTypes.AD_IMPRESSION,EBG.VV.DetectionTypes.PAGE_VISIBILITY,EBG.VV.DetectionTypes.VIEWABILITY_RECORDABLE],_lastUpdateValue:0,_lastUpdateTime:0,_durationAboveThreshold:0,_avg:0,_threshold:.01,_recordable:!1,_isAdImpression:!1,condition:function(t){if(!EBG.callSuperFunction(EBG.VV.Metrics.Classes.ViewableAverage,this,"condition"))return!1;switch(t.type){case EBG.VV.DetectionTypes.AD_IMPRESSION:this._isAdImpression=!0;break;case EBG.VV.DetectionTypes.PAGE_UNLOAD:case EBG.VV.DetectionTypes.AD_UNLOAD:return this.handleUnload(t),this._recordable&&this._isAdImpression;case EBG.VV.DetectionTypes.VIEWABLE_RATIO:case EBG.VV.DetectionTypes.SCREENSHARE_RATIO:this.update(t);break;case EBG.VV.DetectionTypes.PAGE_VISIBILITY:this.updatePageVisibility(t);break;case EBG.VV.DetectionTypes.VIEWABILITY_RECORDABLE:this._recordable=t.value}return!1},handleUnload:function(t){this.updateAverage(t.timestamp)},update:function(t){this.updateAverage(t.timestamp),this._lastUpdateValue=t.value,this._lastUpdateTime=t.timestamp},updatePageVisibility:function(t){t.value||this.updateAverage(t.timestamp),this._lastUpdateTime=t.timestamp},updateAverage:function(t){if(this._lastUpdateValue>this._threshold){var e=this._avg,i=this._durationAboveThreshold,r=this._lastUpdateValue,n=t-this._lastUpdateTime,s=i+n;this._avg=s?(e*i+r*n)/s:0,this.value=Math.round(100*this._avg),this._durationAboveThreshold+=t-this._lastUpdateTime}}},EBG.declareClass(EBG.VV.Metrics.Classes.ViewableAverage,EBG.VV.Metrics.Classes.MetricBase),EBG.VV.Metrics.Threshold.Duration=function(t,e,i,r,n){this._minSurface=i,this._minDuration=r,this.name=n,EBG.callSuperConstructor(EBG.VV.Metrics.Threshold.Duration,this,[t,e])},EBG.VV.Metrics.Threshold.Duration.prototype={name:"",targetType:EBG.VV.TargetType.TARGET_ENTITY,triggers:[EBG.VV.DetectionTypes.PAGE_UNLOAD,EBG.VV.DetectionTypes.AD_UNLOAD,EBG.VV.DetectionTypes.VIEWABLE_RATIO,EBG.VV.DetectionTypes.PAGE_VISIBILITY],_duration:0,_startTime:0,_minSurface:0,_minDuration:0,_running:!1,_visible:!1,_pageVisible:!0,condition:function(t){if(!EBG.callSuperFunction(EBG.VV.Metrics.Threshold.Duration,this,"condition"))return!1;switch(t.type){case EBG.VV.DetectionTypes.PAGE_UNLOAD:case EBG.VV.DetectionTypes.AD_UNLOAD:return this._handleUnload(t.timestamp);case EBG.VV.DetectionTypes.VIEWABLE_RATIO:this._handleViewable(t);break;case EBG.VV.DetectionTypes.PAGE_VISIBILITY:this._handlePageVisibility(t)}return!1},_handleUnload:function(t){return this._stop(t),this.value=Math.round(this._duration/1e3),this._duration>this._minDuration},_handleViewable:function(t){this._pageVisible&&(t.value>=this._minSurface?(this._visible=!0,this._start(t.timestamp)):(this._visible=!1,this._stop(t.timestamp)))},_handlePageVisibility:function(t){t.value?(this._pageVisible=!0,this._visible&&this._start(t.timestamp)):(this._stop(t.timestamp),this._pageVisible=!1)},_start:function(t){this._running||(this._startTime=t,this._running=!0)},_stop:function(t){this._running&&(this._running=!1,this._duration+=t-this._startTime,this._startTime=t)}},EBG.declareClass(EBG.VV.Metrics.Threshold.Duration,EBG.VV.Metrics.Classes.MetricBase),EBG.VV.Metrics.Threshold.Viewable=function(t,e,i,r,n){this._minSurface=i,this._minDuration=r,this.name=n,EBG.callSuperConstructor(EBG.VV.Metrics.Threshold.Viewable,this,[t,e])},EBG.VV.Metrics.Threshold.Viewable.prototype={name:"",targetType:EBG.VV.TargetType.TARGET_ENTITY,sendImmediately:!0,_minSurface:.5,_minDuration:2e3,viewableSinceTimestamp:0,timeout:0,isAdImpression:!1,isPageVisible:!0,viewableRatio:0,overlappedRatio:0,triggers:[EBG.VV.DetectionTypes.AD_IMPRESSION,EBG.VV.DetectionTypes.VIEWABLE_RATIO,EBG.VV.DetectionTypes.PAGE_VISIBILITY,EBG.VV.DetectionTypes.OVERLAP],condition:function(t,e){if(!EBG.callSuperFunction(EBG.VV.Metrics.Threshold.Viewable,this,"condition"))return!1;if(!e)switch(t.type){case EBG.VV.DetectionTypes.PAGE_VISIBILITY:this.isPageVisible=t.value;break;case EBG.VV.DetectionTypes.VIEWABLE_RATIO:this.viewableRatio=t.value;break;case EBG.VV.DetectionTypes.OVERLAP:this.overlappedRatio=1===t.value?1:0;break;case EBG.VV.DetectionTypes.AD_IMPRESSION:this.isAdImpression=!0}if(!this.isAdImpression)return!1;var i=Math.max(this.viewableRatio-this.overlappedRatio,0)>=this._minSurface&&this.isPageVisible;i?this.viewableSinceTimestamp=this.viewableSinceTimestamp||t.timestamp:(this.viewableSinceTimestamp=0,clearTimeout(this.timeout));var r=t.timestamp-this.viewableSinceTimestamp>=this._minDuration;if(i)if(r)this.report(t),t.target.metricsManager.decrease(),0==t.target.metricsManager.count()&&this.target.detectionManager.getDetector(EBG.VV.DetectionTypes.VIEWABLE_RATIO,this.target).destroy()&&"VsIAB"==this.name&&this.target.detectionManager.getDetector(EBG.VV.DetectionTypes.VIEWABLE_RATIO,this.target).notifyViewableReported();else{var n=this._minDuration-(t.timestamp-this.viewableSinceTimestamp),s=this;clearTimeout(this.timeout),this.timeout=setTimeout(EBG.idleCallback((function(){t.timestamp+=n,s.condition(t,!0)})),n)}return!1}},EBG.declareClass(EBG.VV.Metrics.Threshold.Viewable,EBG.VV.Metrics.Classes.MetricBase),EBG.VV.Metrics.Definitions={AD_START:{name:"AdStart"},AD_IMPRESSION:{name:"AdImpression",condition:function(){return EBG.callSuperFunction(EBG.VV.Metrics.Classes.AD_IMPRESSION,this,"condition")&&2===this.target.config.rdi}},AD_ERROR:{name:"AdError",includeDetectionValue:!0},AD_INTERACTION:{name:"ebUserInteraction"},CLICK:{name:"_eyeblaster",condition:function(t){return Boolean(t.target.config.sendClickTracking)}},VIEWABILITY_RECORDABLE:{name:"VsR",condition:function(t){return t.value&&EBG.callSuperFunction(EBG.VV.Metrics.Classes.VIEWABILITY_RECORDABLE,this,"condition")},isValid:function(){return!(!this.target.config.thresholds.IABSurface||!this.target.config.thresholds.IABDuration)}},AGENCY_RECORDABLE:{name:"VsRAg",condition:function(t){return t.target.group.config.viewabilityEnhancedMode&&t.value&&EBG.callSuperFunction(EBG.VV.Metrics.Classes.AGENCY_RECORDABLE,this,"condition")},triggers:[EBG.VV.DetectionTypes.VIEWABILITY_RECORDABLE],isValid:function(){return!(!this.target.config.thresholds.AgencySurface||!this.target.config.thresholds.AgencyDuration)}},ADVERTISER_RECORDABLE:{name:"VsRAd",condition:function(t){return t.target.group.config.viewabilityEnhancedMode&&t.value&&EBG.callSuperFunction(EBG.VV.Metrics.Classes.ADVERTISER_RECORDABLE,this,"condition")},triggers:[EBG.VV.DetectionTypes.VIEWABILITY_RECORDABLE],isValid:function(){return!(!this.target.config.thresholds.AdvertiserSurface||!this.target.config.thresholds.AdvertiserDuration)}},UNIQUE_VIDEO_START:{name:"ebUniqueVideoStarted",category:1,value:1,triggers:[EBG.VV.DetectionTypes.AD_VIDEO_START]},AD_VIDEO_START:{name:"ebVideoStarted",category:1,value:1},AD_VIDEO_FIRST_QUARTILE:{name:"eb25Per_Played",category:1,value:1},AD_VIDEO_MIDPOINT:{name:"eb50Per_Played",category:1,value:1},AD_VIDEO_THIRD_QUARTILE:{name:"eb75Per_Played",category:1,value:1},AD_VIDEO_COMPLETE:{name:"ebVideoFullPlay",category:1,value:1},AD_SKIPPED:{name:"ebSkip"},AD_CAROUSEL:{name:"AdCarousel",_collisionLimits:{min:1e4,max:15e4},condition:function(t){if(this.target.config.featureFlags.RFF_FraudMetrics&&t.value.placementId==this.target.config.placementId){var e=EBG.getTime()-t.value.startTime;if(t.value.removed&&e>this._collisionLimits.min&&e<this._collisionLimits.max)return EBG.callSuperFunction(EBG.VV.Metrics.Classes.AD_CAROUSEL,this,"condition")}return!1},triggers:[EBG.VV.DetectionTypes.CONCURRENT_TARGET]},AD_COLLISION:{name:"AdCollision",condition:function(t){return!(!this.target.config.featureFlags.RFF_FraudMetrics||t.value.advertiserId!=this.target.config.advertiserId||t.value.removed)&&EBG.callSuperFunction(EBG.VV.Metrics.Classes.AD_COLLISION,this,"condition")},triggers:[EBG.VV.DetectionTypes.CONCURRENT_TARGET]},MULTI_BURN:{name:"MultiBurn",condition:function(t){return!(!this.target.config.featureFlags.RFF_FraudMetrics||t.value.placementId!=this.target.config.placementId||t.value.removed)&&EBG.callSuperFunction(EBG.VV.Metrics.Classes.MULTI_BURN,this,"condition")},triggers:[EBG.VV.DetectionTypes.CONCURRENT_TARGET]},END_OF_SESSION:{name:"eos",triggers:[EBG.VV.DetectionTypes.PAGE_UNLOAD,EBG.VV.DetectionTypes.AD_UNLOAD]}},EBG.VV.Metrics.Definitions.CUSTOM_INTERACTION={name:"CUSTOM_INTERACTION",triggers:[EBG.VV.DetectionTypes.AD_INTERACTION,EBG.VV.DetectionTypes.AD_CLICKTHRU],numLeft:1/0,category:0,_usedInteractionNames:[],condition:function(){return!1},isUnique:function(){var t=this._usedInteractionNames,e=this.name;return t=t.indexOf(e,t.indexOf(e)+1),Number(-1==t)}},EBG.VV.Metrics.Definitions.AD_STACKING={name:"AdStacking",targetType:EBG.VV.TargetType.TARGET_ENTITY,triggers:[EBG.VV.DetectionTypes.OVERLAP,EBG.VV.DetectionTypes.VIEWABLE_RATIO],_viewableThreshold:.5,_overlapThreshold:1,_viewable:0,condition:function(t){if(this.target.group.config.featureFlags.RFF_FraudMetrics){if(!EBG.callSuperFunction(EBG.VV.Metrics.Classes.AD_STACKING,this,"condition"))return!1;switch(t.type){case EBG.VV.DetectionTypes.VIEWABLE_RATIO:this._viewable=t.value;break;case EBG.VV.DetectionTypes.OVERLAP:if(this._viewable>=this._viewableThreshold&&t.value>=this._overlapThreshold)return!0}}return!1}},EBG.VV.Metrics.Definitions.AD_PAUSED={triggers:[EBG.VV.DetectionTypes.AD_PAUSED,EBG.VV.DetectionTypes.AD_VIDEO_START,EBG.VV.DetectionTypes.AD_VIDEO_COMPLETE],name:"ebVideoPause",_started:!1,_ended:!1,category:1,condition:function(t){var e=!1;switch(t.type){case EBG.VV.DetectionTypes.AD_PAUSED:this._started&&!this._ended&&(e=!0);break;case EBG.VV.DetectionTypes.AD_VIDEO_START:this._started=!0,this._ended=!1;break;case EBG.VV.DetectionTypes.AD_VIDEO_COMPLETE:this._ended=!0,this._started=!1}if(e)return t.userInitiated=!0,e}},EBG.VV.Metrics.Definitions.VIDEO_PLAY_DURATION={name:"ebVideoPlayDuration",targetType:EBG.VV.TargetType.TARGET_GROUP,triggers:[EBG.VV.DetectionTypes.AD_VIDEO_START,EBG.VV.DetectionTypes.AD_PLAYING,EBG.VV.DetectionTypes.AD_VIDEO_COMPLETE,EBG.VV.DetectionTypes.AD_PAUSED,EBG.VV.DetectionTypes.AD_STOPPED,EBG.VV.DetectionTypes.AD_SKIPPED,EBG.VV.DetectionTypes.AD_UNLOAD,EBG.VV.DetectionTypes.PAGE_UNLOAD],category:1,startTime:0,timerValue:0,playing:!1,condition:function(t){if(!EBG.callSuperFunction(EBG.VV.Metrics.Classes.VIDEO_PLAY_DURATION,this,"condition"))return!1;switch(t.type){case EBG.VV.DetectionTypes.AD_VIDEO_START:this.start(t);break;case EBG.VV.DetectionTypes.AD_PLAYING:!this.playing&&this.startTime>0&&this.start(t);break;case EBG.VV.DetectionTypes.AD_PAUSED:case EBG.VV.DetectionTypes.AD_STOPPED:case EBG.VV.DetectionTypes.AD_VIDEO_COMPLETE:this.stop(t);break;case EBG.VV.DetectionTypes.AD_SKIPPED:case EBG.VV.DetectionTypes.AD_UNLOAD:case EBG.VV.DetectionTypes.PAGE_UNLOAD:case EBG.VV.DetectionTypes.AD_USER_CLOSE:return this.stop(t),this.startTime>0}return!1},start:function(t){this.startTime=t.timestamp,this.playing=!0},stop:function(t){this.playing&&(this.timerValue+=t.timestamp-this.startTime,this.value=Math.round(this.timerValue/1e3),this.startTime=t.timestamp),this.playing=!1}},EBG.VV.Metrics.Definitions.VIDEO_MUTE={triggers:[EBG.VV.DetectionTypes.AD_VOLUME_CHANGE,EBG.VV.DetectionTypes.AD_IMPRESSION],name:"ebVideoMute",category:1,isAdImpression:!1,numLeft:10,previousValue:null,condition:function(t){if(t.type==EBG.VV.DetectionTypes.AD_IMPRESSION)this.isAdImpression=!0;else{var e=0==t.value&&0!=this.previousValue&&this.isAdImpression;if(this.previousValue=t.value,e)return t.userInitiated=!0,EBG.callSuperFunction(EBG.VV.Metrics.Classes.VIDEO_MUTE,this,"condition")}return!1}},EBG.VV.Metrics.Definitions.VIDEO_UNMUTE={triggers:[EBG.VV.DetectionTypes.AD_VOLUME_CHANGE,EBG.VV.DetectionTypes.AD_IMPRESSION],name:"ebVideoUnmute",isAdImpression:!1,category:1,numLeft:10,previousValue:-1,condition:function(t){if(t.type==EBG.VV.DetectionTypes.AD_IMPRESSION)this.isAdImpression=!0;else{var e=t.value>0&&this.previousValue<=0&&this.isAdImpression;if(this.previousValue=t.value,e)return t.userInitiated=!0,EBG.callSuperFunction(EBG.VV.Metrics.Classes.VIDEO_MUTE,this,"condition")}return!1}},EBG.VV.Metrics.Definitions.VIDEO_UNMUTED={triggers:[EBG.VV.DetectionTypes.AD_VOLUME_CHANGE,EBG.VV.DetectionTypes.AD_IMPRESSION],name:"ebVideoUnmuted",category:1,isAdImpression:!1,savedVolume:-1,condition:function(t){return t.type==EBG.VV.DetectionTypes.AD_IMPRESSION&&(this.isAdImpression=!0),t.type==EBG.VV.DetectionTypes.AD_VOLUME_CHANGE&&(this.savedVolume=t.value),this.savedVolume>0&&this.isAdImpression&&EBG.callSuperFunction(EBG.VV.Metrics.Classes.VIDEO_UNMUTED,this,"condition")}},EBG.VV.Metrics.Definitions.AD_DURATION={name:"ebAdDuration",triggers:[EBG.VV.DetectionTypes.PAGE_UNLOAD,EBG.VV.DetectionTypes.AD_UNLOAD,EBG.VV.DetectionTypes.AD_START],startTime:null,condition:function(t){if(!EBG.callSuperFunction(EBG.VV.Metrics.Classes.AD_DURATION,this,"condition"))return!1;if(t.type===EBG.VV.DetectionTypes.AD_START)this.startTime=t.timestamp;else if(this.startTime)return this.value=Math.round((t.timestamp-this.startTime)/1e3),!0;return!1}},EBG.VV.Metrics.Definitions.METRICS={name:"metrics",targetType:EBG.VV.TargetType.TARGET_GROUP,triggers:[EBG.VV.DetectionTypes.USER_AGENT,EBG.VV.DetectionTypes.ANCESTOR_ORIGINS,EBG.VV.DetectionTypes.AD_UNLOAD,EBG.VV.DetectionTypes.PAGE_UNLOAD],category:2,value:{},_propList:"IntrN,IntrT,sid,Usr,pid,adid,turl,ua,aorg,rurl,isUnbundled,AgencyID".split(","),_sendTime:5e3,_timeout:null,_maximumUrlLength:5e3,_maximumAorgUrls:3,initConfig:function(){this.value.IntrN=this.name,this.value.isUnbundled=!0,this.value.IntrT=this.category,this.value.sid=this.target.config.sessionId,this.value.Usr=encodeURIComponent(this.target.config.usercookie),this.value.pid=this.target.config.placementId,this.value.adid=this.target.config.adId,this.value.AgencyID=this.target.config.agencyId,EBG.callSuperFunction(EBG.VV.Metrics.Classes.METRICS,this,"initConfig")},condition:function(t){if(!EBG.callSuperFunction(EBG.VV.Metrics.Classes.METRICS,this,"condition"))return!1;switch(t.type){case EBG.VV.DetectionTypes.USER_AGENT:this.value.ua=encodeURIComponent(t.value);break;case EBG.VV.DetectionTypes.ANCESTOR_ORIGINS:this.value.aorg=this._processAorg(t.value);break;case EBG.VV.DetectionTypes.AD_UNLOAD:case EBG.VV.DetectionTypes.PAGE_UNLOAD:return clearTimeout(this._timeout),!0}if(this.target.targets[0]&&(this.value.turl=encodeURIComponent(this._capUrl(this.target.targets[0].topAccessibleWindow.location.href)),this.value.rurl=encodeURIComponent(this._capUrl(this.target.targets[0].topAccessibleWindow.document.referrer))),this._hasAllData())return clearTimeout(this._timeout),!0;if((e=t.timestamp)>=this._sendTime)return clearTimeout(this._timeout),!0;var e=this._sendTime-e,i=this;return clearTimeout(this._timeout),this._timeout=setTimeout((function(){i.report(t)}),e),!1},_hasAllData:function(){var t,e=0;for(t in this.value)EBG.indexOfArray(this._propList,t)>-1&&e++;return e>=this._propList.length},_capUrl:function(t){return t&&this._maximumUrlLength?t.substring(0,this._maximumUrlLength):t},_processAorg:function(t){var e=[],i=this._maximumAorgUrls;if(window&&"function"==typeof window.URL&&t.length>0){i=i?Math.min(i,t.length):t.length;for(var r=0;r<i;r++)t[r]&&e.push(encodeURIComponent(this._capUrl(t[r])))}return e}},EBG.VV.Metrics.Definitions.PLAYER_PARAMS={name:"plparams",targetType:EBG.VV.TargetType.TARGET_ENTITY,triggers:[EBG.VV.DetectionTypes.AD_SIZE_CHANGE,EBG.VV.DetectionTypes.SCREEN_RECT,EBG.VV.DetectionTypes.WINDOW_RECT],numLeft:5,category:2,value:{},_propList:["vport","psz","oset"],_previousAdSize:{width:0,height:0},_previousValue:{},condition:function(t){return!!EBG.callSuperFunction(EBG.VV.Metrics.Classes.PLAYER_PARAMS,this,"condition")&&(t.type===EBG.VV.DetectionTypes.WINDOW_RECT&&(this.value.vport=Math.floor(t.value.width)+"x"+Math.floor(t.value.height)),(t=this.target.getBoundingClientRect({relativeToTop:!0})).width==this._previousAdSize.width&&t.height==this._previousAdSize.height||(this.value.psz="-1#-1#"+Math.floor(t.width)+"x"+Math.floor(t.height),this._previousAdSize=t),this.value.oset=Math.floor(t.left)+"x"+Math.floor(t.top),this._hasAllData()&&this._hasChanged())},report:function(t){this.numLeft--,EBG.mergeObj(this.value,this._previousValue,!0),this.reportCallback(this,t),this.value={},EBG.mergeObj(this._previousValue,this.value,!0)},_getFullScreen:function(){var t=this.target.element,e=Math.max(t.clientWidth,t.offsetWidth);return t=Math.max(t.clientHeight,t.offsetHeight),Number(screen.width===e&&screen.height===t)},_hasAllData:function(){var t,e=0;for(t in this.value)EBG.indexOfArray(this._propList,t)>-1&&e++;return e>=this._propList.length},_hasChanged:function(){var t=!1;return this._previousValue.psz!=this.value.psz&&(t=!0),t}},EBG.VV.Metrics.DefinitionClassFactory=function(){},EBG.VV.Metrics.DefinitionClassFactory.prototype={makeMetricClasses:function(t){for(var e in t)t.hasOwnProperty(e)&&t[e]!=EBG.VV.Metrics.Classes.MetricBase&&this._makeDef(e,t[e])},_makeDef:function(t,e){for(var i in EBG.VV.Metrics.Classes[t]=function(e,i){EBG.callSuperConstructor(EBG.VV.Metrics.Classes[t],this,[e,i])},e)e.hasOwnProperty(i)&&(EBG.VV.Metrics.Classes[t].prototype[i]=e[i]);EBG.VV.Metrics.Classes[t].prototype.triggers||(EBG.VV.Metrics.Classes[t].prototype.triggers=[EBG.VV.DetectionTypes[t]]),EBG.declareClass(EBG.VV.Metrics.Classes[t],EBG.VV.Metrics.Classes.MetricBase)}},(new EBG.VV.Metrics.DefinitionClassFactory).makeMetricClasses(EBG.VV.Metrics.Definitions),EBG.vv=new EBG.VV}}new function(){this.shared=this.shared||new R,this.metricSender=this.metricSender||new o(this.shared);var t=!1,e=this,i=[50,1,100,3,75,15];this.initData={},this.aSubscribers=[];var r=c("script");for(var n in r)if(new RegExp("adserving-display-uv.js","g").test(r[n].src)){t=!0;var s,a=r[n].src,h={},u=a.substr(a.indexOf("?")+1).split("&");for(var l in u)"string"==typeof u[l]&&(h[(s=u[l].split("="))[0].toLowerCase()]=decodeURIComponent(s[1]));e.shared.protocol.set("SAS"),this.getAncestorOrigins=function(){var t=[];if("undefined"!==location.ancestorOrigins&&location.ancestorOrigins.length)t.push("https://"+location.ancestorOrigins[location.ancestorOrigins.length-1]);else for(var e=window;e!==window.top;){if(e.document.referrer)try{var i=new URL(e.document.referrer);t.push(i.origin)}catch(t){}e=e.parent}return t.length||t.push(window.top.location.href),t.pop()};var d=!0;if("string"==typeof h.slot){var g=c("#"+h.slot);if(g.length=1){for(var n in g){var p=g[n];this.shared.creativeData.setSlot(p)}d=this.shared.creativeData.isInited()}else this.shared.catch({message:"Can't get the slot by ID "+h.slot}),d=!1}else this.shared.catch({message:"Can't get the banner slot ID from the GET variables"});if(this.shared.creativeData.isInited()&&("string"==typeof h.campaign?this.shared.campaignData.setCampaignId(h.campaign):(this.shared.catch({message:"Can't get the campaign ID from the GET variables"}),d=!1),"string"==typeof h.ad?this.shared.campaignData.setPlacementId(h.ad):(this.shared.catch({message:"Can't get the ad ID from the GET variables"}),d=!1),"string"==typeof h.host&&(this.shared.report_host=h.host),"string"==typeof h.uniq&&this.shared.userData.setUserCookie(h.uniq),"string"==typeof h.session&&this.shared.userData.setSessionId(h.session)),1==d){var V={IABMS:i[0],IABMD:i[1],AgMS:i[2],AgMD:i[3],usercookie:this.shared.userData.getUserCookie(),aid:this.shared.campaignData.getPlacementId(),pid:this.shared.campaignData.getCampaignId(),advid:this.shared.campaignData.getAdvertiserId(),instreamFeatureFlags:{IFF_UnloadQueue:!0,IFF_Tick:!0,IFF_FraudMetrics:!0},reportingFF:{RFF_UnloadQueue:!0,RFF_Tick:!0,RFF_FraudMetrics:!0},isClick:!0,sessionid:this.shared.userData.getSessionId(),oo:0,diappid:-1,agid:this.shared.campaignData.getSdgId(),ebPtcl:"https://",rdi:2,seg:this.shared.campaignData.getSdgId(),src:"ya",reportHost:this.shared.report_host,isInstream:1};this.initData.creativeData={AdParameters:JSON.stringify(V)},this.shared.data.initData.adParameters=new G(this.initData.creativeData,this.shared),this.shared.verification.load(),this.metricSender.sendDomain(this.getAncestorOrigins()),this.shared.creativeData.getSlot().addEventListener("click",(function(){e.metricSender.sendClick(e.getAncestorOrigins())}),!1)}else this.shared.catch({message:"Can't get the slot"});break}0==t&&this.shared.catch({message:"Can't get the current script"})}}()}();